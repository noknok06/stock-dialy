{% extends 'base.html' %}

{% block title %}プロフィール | カブログ{% endblock %}

{% block head %}
{{ block.super }}
<style>
  .badge {
    font-size: 0.875rem;
    padding: 0.35em 0.65em;
  }

  .list-group-item {
    border-left: none;
    border-right: none;
  }

  .list-group-item:first-child {
    border-top: none;
  }

  .list-group-item:last-child {
    border-bottom: none;
  }  
  
  .profile-card {
    border: none;
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-lg);
    overflow: hidden;
    background-color: var(--bg-primary);
  }
  
  .profile-header {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
    padding: 2rem;
    color: var(--text-inverse);
    text-align: center;
  }
  
  .profile-img {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    background-color: var(--bg-primary);
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 1rem;
    font-size: 3rem;
    color: var(--primary-color);
  }
  
  .profile-body {
    padding: 2rem;
  }
  
  .profile-section {
    margin-bottom: 2rem;
  }
  
  .profile-section-title {
    font-size: 1.25rem;
    font-weight: 600;
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid var(--border-primary);
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--text-primary);
  }
  
  .stats-card {
    background-color: var(--bg-secondary);
    border: 1px solid var(--border-light);
    border-radius: var(--radius-md);
    padding: 1.5rem;
    text-align: center;
    transition: all 0.3s ease;
  }
  
  .stats-card:hover {
    transform: translateY(-5px);
    box-shadow: var(--shadow-md);
    border-color: var(--primary-color);
  }
  
  .stats-number {
    font-size: 2rem;
    font-weight: 700;
    color: var(--primary-color);
    margin-bottom: 0.5rem;
  }
  
  .stats-label {
    color: var(--text-secondary);
    font-size: 0.875rem;
  }
  
  .recent-item {
    padding: 1rem;
    border-radius: var(--radius-md);
    background-color: var(--bg-secondary);
    border: 1px solid var(--border-light);
    margin-bottom: 0.75rem;
    transition: all 0.3s ease;
  }
  
  .recent-item:hover {
    background-color: var(--surface-hover);
    transform: translateX(5px);
    border-color: var(--primary-color);
  }
  
  .recent-item-title {
    font-weight: 600;
    margin-bottom: 0.25rem;
    color: var(--text-primary);
  }
  
  .recent-item-meta {
    color: var(--text-secondary);
    font-size: 0.875rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  
  .recent-item-meta a {
    color: var(--primary-color);
    text-decoration: none;
  }
  
  .recent-item-meta a:hover {
    color: var(--primary-dark);
  }
  
  /* Dark Mode Support */
  .dark-mode .profile-card,
  [data-theme="dark"] .profile-card {
    background-color: var(--dm-card);
    border: 1px solid var(--dm-border);
  }
  
  .dark-mode .profile-header,
  [data-theme="dark"] .profile-header {
    background: linear-gradient(135deg, var(--dm-primary) 0%, var(--dm-primary-hover) 100%);
  }
  
  .dark-mode .profile-img,
  [data-theme="dark"] .profile-img {
    background-color: var(--dm-card);
    color: var(--dm-primary);
  }
  
  .dark-mode .profile-body,
  [data-theme="dark"] .profile-body {
    color: var(--dm-foreground);
  }
  
  .dark-mode .profile-section-title,
  [data-theme="dark"] .profile-section-title {
    color: var(--dm-foreground);
    border-bottom-color: var(--dm-border);
  }
  
  .dark-mode .stats-card,
  [data-theme="dark"] .stats-card {
    background-color: rgba(71, 85, 105, 0.3);
    border-color: var(--dm-border);
  }
  
  .dark-mode .stats-card:hover,
  [data-theme="dark"] .stats-card:hover {
    border-color: var(--dm-primary);
    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
  }
  
  .dark-mode .stats-number,
  [data-theme="dark"] .stats-number {
    color: var(--dm-primary);
  }
  
  .dark-mode .stats-label,
  [data-theme="dark"] .stats-label {
    color: var(--dm-muted-foreground);
  }
  
  .dark-mode .recent-item,
  [data-theme="dark"] .recent-item {
    background-color: rgba(71, 85, 105, 0.3);
    border-color: var(--dm-border);
  }
  
  .dark-mode .recent-item:hover,
  [data-theme="dark"] .recent-item:hover {
    background-color: rgba(71, 85, 105, 0.5);
    border-color: var(--dm-primary);
  }
  
  .dark-mode .recent-item-title,
  [data-theme="dark"] .recent-item-title {
    color: var(--dm-foreground);
  }
  
  .dark-mode .recent-item-meta,
  [data-theme="dark"] .recent-item-meta {
    color: var(--dm-muted-foreground);
  }
  
  .dark-mode .recent-item-meta a,
  [data-theme="dark"] .recent-item-meta a {
    color: var(--dm-primary);
  }
  
  .dark-mode .recent-item-meta a:hover,
  [data-theme="dark"] .recent-item-meta a:hover {
    color: var(--dm-primary-hover);
  }
  
  .dark-mode .alert-info,
  [data-theme="dark"] .alert-info {
    background-color: rgba(59, 130, 246, 0.1);
    border-color: rgba(59, 130, 246, 0.3);
    color: var(--dm-foreground);
  }
</style>
{% endblock %}

{% block content %}
<div class="container py-5">
  <div class="profile-card">
    <div class="profile-header">
      <div class="profile-img">
        <i class="bi bi-person"></i>
      </div>
      <h2>{{ user.username }}</h2>
      <p>{{ user.email }}</p>
      <p>登録日: {{ user.date_joined|date:"Y年m月d日" }}</p>
    </div>
    
    <div class="profile-body">
      <!-- 統計情報 -->
      <div class="profile-section">
        <h3 class="profile-section-title">
          <i class="bi bi-bar-chart-line"></i> 投資記録の統計
        </h3>
        
        <div class="row row-cols-1 row-cols-md-3 g-4">
          <div class="col">
            <div class="stats-card">
              <div class="stats-number">{{ diary_count }}</div>
              <div class="stats-label">記録した銘柄</div>
            </div>
          </div>
                
          <div class="col">
            <div class="stats-card">
              <div class="stats-number">{{ template_count }}</div>
              <div class="stats-label">分析テンプレート</div>
            </div>
          </div>
          
          <div class="col">
            <div class="stats-card">
              <div class="stats-number">{{ tag_count }}</div>
              <div class="stats-label">作成したタグ</div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- 最近の投資日記 -->
      <div class="profile-section">
        <h3 class="profile-section-title">
          <i class="bi bi-journal-text"></i> 最近の投資日記
        </h3>
        
        {% if recent_diaries %}
          {% for diary in recent_diaries %}
            <div class="recent-item">
              <div class="recent-item-title">{{ diary.stock_name }} ({{ diary.stock_symbol }})</div>
              <div class="recent-item-meta">
                <i class="bi bi-calendar"></i> {{ diary.created_at|date:"Y年m月d日" }}
                <span class="ms-3">
                  <i class="bi bi-cash"></i> {{ diary.total_cost }} 円 × {{ diary.current_quantity }} 株
                </span>
                <a href="{% url 'stockdiary:detail' diary.id %}" class="ms-auto">
                  <i class="bi bi-arrow-right"></i> 詳細
                </a>
              </div>
            </div>
          {% endfor %}
        {% else %}
          <div class="alert alert-info">
            <i class="bi bi-info-circle me-2"></i>
            まだ投資日記がありません。記録を始めましょう！
          </div>
        {% endif %}
        
        <div class="text-center mt-4">
          <a href="{% url 'stockdiary:home' %}" class="btn btn-outline-primary">
            <i class="bi bi-journal-text me-1"></i> すべての投資日記を見る
          </a>
        </div>
      </div>
   
      <!-- アカウント設定 -->
      <div class="profile-section">
        <h3 class="profile-section-title">
          <i class="bi bi-gear"></i> アカウント設定
        </h3>
        
        <div class="d-grid gap-2 d-md-flex">
          <a href="{% url 'users:profile_edit' %}" class="btn btn-outline-info">
            <i class="bi bi-pencil me-1"></i> プロフィール編集
          </a>
          <a href="{% url 'users:password_change' %}" class="btn btn-outline-warning">
            <i class="bi bi-shield-lock me-1"></i> パスワード変更
          </a>
          <a href="{% url 'users:logout' %}" class="btn btn-outline-danger">
            <i class="bi bi-box-arrow-right me-1"></i> ログアウト
          </a>
          <a href="{% url 'users:account_delete_confirm' %}" class="btn btn-outline-danger">
            <i class="bi bi-trash me-1"></i> アカウント削除
          </a>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}