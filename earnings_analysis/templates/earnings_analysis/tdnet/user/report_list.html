{% extends "base.html" %}
{% load static %}

{% block title %}{{ company_name }}のレポート | カブログ{% endblock %}

{% block head %}
<style>
/* 企業ヘッダー */
.company-hero {
  background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
  border-radius: var(--radius-xl);
  padding: 2rem;
  color: white;
  margin-bottom: 1.5rem;
  display: flex;
  align-items: center;
  justify-content: space-between;
  flex-wrap: wrap;
  gap: 1rem;
}

.company-info-main {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.company-code-hero {
  background: rgba(255,255,255,0.2);
  padding: 0.5rem 1rem;
  border-radius: var(--radius-md);
  font-size: 1.25rem;
  font-weight: 700;
}

.company-name-hero {
  font-size: 1.75rem;
  font-weight: 700;
}

.company-stats {
  display: flex;
  gap: 2rem;
}

.company-stat {
  text-align: center;
}

.company-stat-value {
  font-size: 2rem;
  font-weight: 800;
}

.company-stat-label {
  font-size: 0.875rem;
  opacity: 0.9;
}

/* タイムライン形式 */
.timeline {
  position: relative;
  padding-left: 2rem;
}

.timeline::before {
  content: '';
  position: absolute;
  left: 0.5rem;
  top: 0;
  bottom: 0;
  width: 2px;
  background: var(--border-color);
}

.timeline-item {
  position: relative;
  margin-bottom: 1.5rem;
}

.timeline-dot {
  position: absolute;
  left: -1.75rem;
  top: 0.5rem;
  width: 12px;
  height: 12px;
  border-radius: 50%;
  border: 2px solid white;
  box-shadow: 0 0 0 3px var(--border-color);
}

.timeline-dot.strong_positive { background: #10b981; box-shadow: 0 0 0 3px #d1fae5; }
.timeline-dot.positive { background: #06b6d4; box-shadow: 0 0 0 3px #cffafe; }
.timeline-dot.neutral { background: #9ca3af; box-shadow: 0 0 0 3px #f3f4f6; }
.timeline-dot.negative { background: #f97316; box-shadow: 0 0 0 3px #ffedd5; }
.timeline-dot.strong_negative { background: #ef4444; box-shadow: 0 0 0 3px #fee2e2; }

.timeline-card {
  background: var(--bg-primary);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-lg);
  overflow: hidden;
  transition: all 0.2s ease;
}

.timeline-card:hover {
  border-color: var(--primary-color);
  box-shadow: var(--shadow-md);
}

.timeline-card a {
  text-decoration: none;
  color: inherit;
  display: block;
}

.timeline-header {
  padding: 1rem;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 1rem;
  border-bottom: 1px solid var(--border-light);
}

.timeline-date {
  font-size: 0.875rem;
  color: var(--text-secondary);
  display: flex;
  align-items: center;
  gap: 0.375rem;
}

.timeline-signal {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.signal-tag {
  padding: 0.25rem 0.75rem;
  border-radius: var(--radius-full);
  font-size: 0.75rem;
  font-weight: 600;
}

.signal-tag.strong_positive { background: #d1fae5; color: #065f46; }
.signal-tag.positive { background: #cffafe; color: #0e7490; }
.signal-tag.neutral { background: #f3f4f6; color: #4b5563; }
.signal-tag.negative { background: #ffedd5; color: #9a3412; }
.signal-tag.strong_negative { background: #fee2e2; color: #991b1b; }

.score-tag {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  font-size: 0.875rem;
}

.score-tag.high { background: #d1fae5; color: #065f46; }
.score-tag.medium { background: #cffafe; color: #0e7490; }
.score-tag.low { background: #fee2e2; color: #991b1b; }

.timeline-body {
  padding: 1rem;
}

.timeline-title {
  font-size: 1.125rem;
  font-weight: 700;
  color: var(--text-primary);
  margin-bottom: 0.5rem;
}

.timeline-summary {
  font-size: 0.9375rem;
  color: var(--text-secondary);
  line-height: 1.5;
}

.timeline-points {
  display: flex;
  gap: 0.5rem;
  margin-top: 0.75rem;
  flex-wrap: wrap;
}

.point-chip {
  background: var(--bg-secondary);
  padding: 0.375rem 0.625rem;
  border-radius: var(--radius-sm);
  font-size: 0.8125rem;
}

/* レスポンシブ */
@media (max-width: 768px) {
  .company-hero {
    flex-direction: column;
    text-align: center;
  }
  
  .company-info-main {
    flex-direction: column;
  }
  
  .company-name-hero {
    font-size: 1.5rem;
  }
  
  .company-stats {
    gap: 1.5rem;
  }
  
  .timeline {
    padding-left: 1.5rem;
  }
  
  .timeline-header {
    flex-direction: column;
    align-items: flex-start;
  }
}
</style>
{% endblock %}

{% block content %}
<!-- 戻るリンク -->
<a href="{% url 'copomo:tdnet-report-list' %}" class="back-link">
  <i class="bi bi-arrow-left"></i> レポート一覧に戻る
</a>

<!-- 企業ヘッダー -->
<div class="company-hero">
  <div class="company-info-main">
    <div class="company-code-hero">{{ company_code }}</div>
    <div class="company-name-hero">{{ company_name }}</div>
  </div>
  <div class="company-stats">
    <div class="company-stat">
      <div class="company-stat-value">{{ reports.count }}</div>
      <div class="company-stat-label">レポート数</div>
    </div>
    {% if company_master %}
    <div class="company-stat">
      <div class="company-stat-value">{{ company_master.industry|default:"-" }}</div>
      <div class="company-stat-label">業種</div>
    </div>
    {% endif %}
  </div>
</div>

<!-- タイムライン -->
{% if reports %}
<div class="timeline">
  {% for report in reports %}
  <div class="timeline-item">
    <div class="timeline-dot {{ report.signal }}"></div>
    <div class="timeline-card">
      <a href="{% url 'copomo:tdnet-report-detail' report.report_id %}">
        <div class="timeline-header">
          <div class="timeline-date">
            <i class="bi bi-calendar3"></i>
            {{ report.published_at|date:"Y年m月d日" }}
          </div>
          <div class="timeline-signal">
            <span class="signal-tag {{ report.signal }}">
              {% if report.signal == 'strong_positive' %}強い買い
              {% elif report.signal == 'positive' %}やや強気
              {% elif report.signal == 'neutral' %}様子見
              {% elif report.signal == 'negative' %}やや弱気
              {% else %}警戒{% endif %}
            </span>
            <span class="score-tag {% if report.overall_score >= 60 %}high{% elif report.overall_score >= 40 %}medium{% else %}low{% endif %}">
              {{ report.overall_score }}
            </span>
          </div>
        </div>
        <div class="timeline-body">
          <h3 class="timeline-title">{{ report.one_line_summary|default:report.title }}</h3>
          <p class="timeline-summary">{{ report.summary }}</p>
          {% if report.key_points %}
          <div class="timeline-points">
            {% for point in report.key_points|slice:":2" %}
            <span class="point-chip">{{ point }}</span>
            {% endfor %}
          </div>
          {% endif %}
        </div>
      </a>
    </div>
  </div>
  {% endfor %}
</div>

<!-- ページネーション -->
{% if page_obj.has_other_pages %}
<nav class="mt-4">
  <ul class="pagination justify-content-center">
    {% if page_obj.has_previous %}
    <li class="page-item">
      <a class="page-link" href="?page={{ page_obj.previous_page_number }}">
        <i class="bi bi-chevron-left"></i>
      </a>
    </li>
    {% endif %}
    <li class="page-item disabled">
      <span class="page-link">{{ page_obj.number }} / {{ page_obj.paginator.num_pages }}</span>
    </li>
    {% if page_obj.has_next %}
    <li class="page-item">
      <a class="page-link" href="?page={{ page_obj.next_page_number }}">
        <i class="bi bi-chevron-right"></i>
      </a>
    </li>
    {% endif %}
  </ul>
</nav>
{% endif %}

{% else %}
<div class="empty-state">
  <div class="empty-icon">
    <i class="bi bi-file-earmark-x"></i>
  </div>
  <h4>レポートがありません</h4>
  <p>この企業の公開レポートはまだありません。</p>
</div>
{% endif %}
{% endblock %}