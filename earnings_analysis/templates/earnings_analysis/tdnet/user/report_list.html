{% extends "base.html" %}
{% load static %}

{% block title %}{{ company_name }}のレポート | カブログ{% endblock %}

{% block head %}
<link rel="stylesheet" href="{% static 'css/2-layouts/tdnet-report-list.css' %}">
{% endblock %}

{% block content %}
<!-- 戻るリンク -->
<a href="{% url 'copomo:tdnet-report-list' %}" class="back-link">
  <i class="bi bi-arrow-left"></i> レポート一覧に戻る
</a>

<!-- 企業ヘッダー -->
<div class="company-hero">
  <div class="company-info-main">
    <div class="company-code-hero">{{ company_code }}</div>
    <div class="company-name-hero">{{ company_name }}</div>
  </div>
  <div class="company-stats">
    <div class="company-stat">
      <div class="company-stat-value">{{ reports.count }}</div>
      <div class="company-stat-label">レポート数</div>
    </div>
    {% if avg_score %}
    <div class="company-stat">
      <div class="company-stat-value">{{ avg_score|floatformat:0 }}</div>
      <div class="company-stat-label">平均スコア</div>
    </div>
    {% endif %}
  </div>
</div>

<!-- レポート一覧（グリッド） -->
{% if reports %}
<div class="report-grid">
  {% for report in reports %}
  <a href="{% url 'copomo:tdnet-report-detail' report.report_id %}" class="report-card">
    <div class="report-card-header">
      <div class="report-date">
        <i class="bi bi-calendar3"></i>
        {{ report.published_at|date:"Y/m/d" }}
      </div>
      <div class="report-signal">
        <span class="signal-tag {{ report.signal }}">
          {% if report.signal == 'strong_positive' %}強い買い
          {% elif report.signal == 'positive' %}やや強気
          {% elif report.signal == 'neutral' %}様子見
          {% elif report.signal == 'negative' %}やや弱気
          {% else %}警戒{% endif %}
        </span>
        <span class="score-badge {% if report.overall_score >= 60 %}high{% elif report.overall_score >= 40 %}medium{% else %}low{% endif %}">
          {{ report.overall_score }}
        </span>
      </div>
    </div>
    <div class="report-card-body">
      <h3 class="report-title">{{ report.one_line_summary|default:report.title }}</h3>
      <p class="report-summary">{{ report.summary }}</p>
      {% if report.key_points %}
      <div class="report-chips">
        {% for point in report.key_points|slice:":2" %}
        <span class="chip">{{ point|truncatechars:20 }}</span>
        {% endfor %}
      </div>
      {% endif %}
    </div>
  </a>
  {% endfor %}
</div>

<!-- ページネーション -->
{% if page_obj.has_other_pages %}
<div class="pagination-wrap">
  {% if page_obj.has_previous %}
  <a href="?page={{ page_obj.previous_page_number }}" class="page-btn">
    <i class="bi bi-chevron-left"></i>
  </a>
  {% endif %}
  
  <span class="page-info">{{ page_obj.number }} / {{ page_obj.paginator.num_pages }}</span>
  
  {% if page_obj.has_next %}
  <a href="?page={{ page_obj.next_page_number }}" class="page-btn">
    <i class="bi bi-chevron-right"></i>
  </a>
  {% endif %}
</div>
{% endif %}

{% else %}
<div class="empty-state">
  <div class="empty-icon">
    <i class="bi bi-file-earmark-x"></i>
  </div>
  <h4>レポートがありません</h4>
  <p>この企業の公開レポートはまだありません。</p>
</div>
{% endif %}
{% endblock %}