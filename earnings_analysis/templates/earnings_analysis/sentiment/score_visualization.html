<!-- earnings_analysis/templates/earnings_analysis/sentiment/score_visualization.html -->
<div class="score-visualization-component">
    {% if positive_words or positive_scores %}
        <div class="positive-scores mb-3">
            <h6 class="text-success mb-2">
                <i class="fas fa-thumbs-up me-1"></i>
                ポジティブ語彙 
                <span class="badge bg-success">{{ positive_words|length|default:positive_scores|length }}語</span>
            </h6>
            
            {% if positive_words %}
                <!-- 語彙情報付きの表示 -->
                <div class="row">
                    {% for word_info in positive_words|slice:":6" %}
                        <div class="col-md-6 col-lg-4 mb-2">
                            <div class="card card-body p-2 border-success">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <span class="fw-semibold">{{ word_info.word }}</span>
                                        {% if word_info.count > 1 %}
                                            <span class="badge bg-info badge-sm">×{{ word_info.count }}</span>
                                        {% endif %}
                                    </div>
                                    <span class="badge bg-success">+{{ word_info.score|floatformat:1 }}</span>
                                </div>
                                {% if word_info.type %}
                                    <small class="text-muted">{{ word_info.type }}</small>
                                {% endif %}
                            </div>
                        </div>
                    {% endfor %}
                </div>
                
                {% if positive_words|length > 6 %}
                    <button class="btn btn-sm btn-outline-success" type="button" data-bs-toggle="collapse" data-bs-target="#morePositiveWords">
                        他 {{ positive_words|length|add:"-6" }}語を表示
                    </button>
                    <div class="collapse mt-2" id="morePositiveWords">
                        <div class="row">
                            {% for word_info in positive_words|slice:"6:" %}
                                <div class="col-md-6 col-lg-4 mb-1">
                                    <div class="d-flex justify-content-between align-items-center p-1 border rounded">
                                        <span class="small">{{ word_info.word }}</span>
                                        <span class="badge bg-success badge-sm">+{{ word_info.score|floatformat:1 }}</span>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                {% endif %}
            {% else %}
                <!-- スコアのみの表示（フォールバック） -->
                <div>
                    {% for score in positive_scores|slice:":10" %}
                        <span class="badge bg-success me-1 mb-1">+{{ score|floatformat:1 }}</span>
                    {% endfor %}
                    {% if positive_scores|length > 10 %}
                        <span class="badge bg-secondary">...他{{ positive_scores|length|add:"-10" }}個</span>
                    {% endif %}
                </div>
            {% endif %}
        </div>
    {% endif %}

    {% if negative_words or negative_scores %}
        <div class="negative-scores">
            <h6 class="text-danger mb-2">
                <i class="fas fa-thumbs-down me-1"></i>
                ネガティブ語彙 
                <span class="badge bg-danger">{{ negative_words|length|default:negative_scores|length }}語</span>
            </h6>
            
            {% if negative_words %}
                <!-- 語彙情報付きの表示 -->
                <div class="row">
                    {% for word_info in negative_words|slice:":6" %}
                        <div class="col-md-6 col-lg-4 mb-2">
                            <div class="card card-body p-2 border-danger">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <span class="fw-semibold">{{ word_info.word }}</span>
                                        {% if word_info.count > 1 %}
                                            <span class="badge bg-info badge-sm">×{{ word_info.count }}</span>
                                        {% endif %}
                                    </div>
                                    <span class="badge bg-danger">{{ word_info.score|floatformat:1 }}</span>
                                </div>
                                {% if word_info.type %}
                                    <small class="text-muted">{{ word_info.type }}</small>
                                {% endif %}
                            </div>
                        </div>
                    {% endfor %}
                </div>
                
                {% if negative_words|length > 6 %}
                    <button class="btn btn-sm btn-outline-danger" type="button" data-bs-toggle="collapse" data-bs-target="#moreNegativeWords">
                        他 {{ negative_words|length|add:"-6" }}語を表示
                    </button>
                    <div class="collapse mt-2" id="moreNegativeWords">
                        <div class="row">
                            {% for word_info in negative_words|slice:"6:" %}
                                <div class="col-md-6 col-lg-4 mb-1">
                                    <div class="d-flex justify-content-between align-items-center p-1 border rounded">
                                        <span class="small">{{ word_info.word }}</span>
                                        <span class="badge bg-danger badge-sm">{{ word_info.score|floatformat:1 }}</span>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                {% endif %}
            {% else %}
                <!-- スコアのみの表示（フォールバック） -->
                <div>
                    {% for score in negative_scores|slice:":10" %}
                        <span class="badge bg-danger me-1 mb-1">{{ score|floatformat:1 }}</span>
                    {% endfor %}
                    {% if negative_scores|length > 10 %}
                        <span class="badge bg-secondary">...他{{ negative_scores|length|add:"-10" }}個</span>
                    {% endif %}
                </div>
            {% endif %}
        </div>
    {% endif %}

    {% if not positive_words and not positive_scores and not negative_words and not negative_scores %}
        <div class="text-center text-muted py-3">
            <i class="fas fa-search fa-2x mb-2"></i>
            <div>感情を表す語彙が検出されませんでした</div>
        </div>
    {% endif %}
</div>

<style>
.badge-sm {
    font-size: 0.65rem;
}
</style>