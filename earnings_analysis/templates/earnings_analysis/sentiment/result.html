<!-- earnings_analysis/templates/earnings_analysis/sentiment/result.htmlï¼ˆè©³ç´°è¡¨ç¤ºå¼·åŒ–ç‰ˆï¼‰ -->
{% extends 'earnings_analysis/base.html' %}
{% load static %}
{% load sentiment_filters %}

{% block title %}æ„Ÿæƒ…åˆ†æçµæœ - {{ document.company_name }} - æ±ºç®—æ›¸é¡ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ {% endblock %}

{% block breadcrumb %}
<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{% url 'earnings_analysis:index' %}">ãƒ›ãƒ¼ãƒ </a></li>
        <li class="breadcrumb-item"><a href="{% url 'earnings_analysis:document-detail-ui' document.doc_id %}">{{ document.doc_id }}</a></li>
        <li class="breadcrumb-item"><a href="{% url 'earnings_analysis:sentiment-analysis' document.doc_id %}">æ„Ÿæƒ…åˆ†æ</a></li>
        <li class="breadcrumb-item active">åˆ†æçµæœ</li>
    </ol>
</nav>
{% endblock %}

{% block extra_css %}
<style>
    .result-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 1rem;
        padding: 2rem;
        margin-bottom: 2rem;
    }
    
    .result-card {
        border: none;
        border-radius: 1rem;
        box-shadow: 0 4px 6px rgba(0,0,0,0.07);
        margin-bottom: 1.5rem;
    }
    
    .sentiment-score-large {
        font-size: 4rem;
        font-weight: 700;
        text-align: center;
        padding: 3rem 2rem;
        border-radius: 1rem;
        margin: 1rem 0;
    }
    
    .sentiment-positive {
        background: linear-gradient(135deg, #48bb78, #38a169);
        color: white;
    }
    
    .sentiment-negative {
        background: linear-gradient(135deg, #f56565, #e53e3e);
        color: white;
    }
    
    .sentiment-neutral {
        background: linear-gradient(135deg, #a0aec0, #718096);
        color: white;
    }
    
    .insight-card {
        background: linear-gradient(135deg, #e8f4fd, #f0f9ff);
        border: 1px solid #93c5fd;
        border-radius: 1rem;
        padding: 1.5rem;
        margin: 1rem 0;
    }
    
    .word-stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin: 1rem 0;
    }
    
    .word-stat-item {
        background: white;
        border: 1px solid #e5e7eb;
        border-radius: 0.75rem;
        padding: 1.5rem;
        text-align: center;
        transition: transform 0.2s ease;
    }
    
    .word-stat-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    .detailed-breakdown {
        background: #f8fafc;
        border-radius: 0.75rem;
        padding: 1.5rem;
        margin: 1rem 0;
    }
    
    .sentence-analysis-section {
        margin-top: 2rem;
    }
    
    .analyzed-sentence {
        background: white;
        border: 1px solid #e5e7eb;
        border-radius: 0.75rem;
        padding: 1rem;
        margin: 0.75rem 0;
        border-left: 5px solid #d1d5db;
    }
    
    .analyzed-sentence.positive {
        border-left-color: #10b981;
        background: linear-gradient(to right, #ecfdf5, #ffffff);
    }
    
    .analyzed-sentence.negative {
        border-left-color: #ef4444;
        background: linear-gradient(to right, #fef2f2, #ffffff);
    }
    
    .keyword-highlight {
        background: #fef3c7;
        color: #92400e;
        padding: 0.2rem 0.4rem;
        border-radius: 0.25rem;
        font-weight: 600;
        margin: 0 0.1rem;
    }
    
    .insight-suggestion {
        background: linear-gradient(135deg, #dbeafe, #bfdbfe);
        border: 1px solid #60a5fa;
        border-radius: 0.75rem;
        padding: 1.5rem;
        margin: 1rem 0;
    }
    
    .recommendation-list {
        list-style: none;
        padding: 0;
    }
    
    .recommendation-list li {
        background: white;
        border: 1px solid #e5e7eb;
        border-radius: 0.5rem;
        padding: 1rem;
        margin: 0.5rem 0;
        position: relative;
        padding-left: 3rem;
    }
    
    .recommendation-list li::before {
        content: "ğŸ’¡";
        position: absolute;
        left: 1rem;
        top: 1rem;
        font-size: 1.2rem;
    }
    
    .impact-indicator {
        display: inline-block;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        margin-right: 0.5rem;
    }
    
    .impact-high { background: #dc2626; }
    .impact-medium { background: #f59e0b; }
    .impact-low { background: #10b981; }
    
    .text-purple { color: #8b5cf6 !important; }
    
    .alert-heading {
        margin-bottom: 0.5rem;
    }
    
    .progress {
        background-color: #e5e7eb;
    }
    
    .badge {
        font-size: 0.8rem;
    }
</style>
{% endblock %}

{% block content %}
<!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
<div class="result-header">
    <div class="row align-items-center">
        <div class="col-md-8">
            <h1 class="h3 mb-2">
                <i class="fas fa-chart-line me-3"></i>æ„Ÿæƒ…åˆ†æçµæœ
            </h1>
            <p class="h5 mb-3 opacity-90">{{ document.company_name }}</p>
            <p class="mb-0 opacity-80">{{ document.doc_description }}</p>
        </div>
        <div class="col-md-4 text-md-end mt-3 mt-md-0">
            <div class="badge bg-light text-dark fs-6 px-3 py-2 mb-2">
                <i class="fas fa-calendar me-1"></i>{{ session.created_at|date:"Y/m/d H:i" }}
            </div>
            <br>
            <div class="badge bg-success fs-6 px-3 py-2">
                <i class="fas fa-check me-1"></i>åˆ†æå®Œäº†
            </div>
        </div>
    </div>
</div>

<div class="row">
    <!-- ãƒ¡ã‚¤ãƒ³çµæœã‚¨ãƒªã‚¢ -->
    <div class="col-lg-8">
        <!-- å…¨ä½“æ„Ÿæƒ…ã‚¹ã‚³ã‚¢ -->
        <div class="result-card card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-thermometer-half me-2"></i>å…¨ä½“æ„Ÿæƒ…ã‚¹ã‚³ã‚¢
                </h5>
            </div>
            <div class="card-body">
                <div class="row align-items-center">
                    <div class="col-md-6">
                        {% if session.sentiment_label == 'positive' %}
                            <div class="sentiment-score-large sentiment-positive">
                                <div>{{ session.overall_score|floatformat:3 }}</div>
                                <div class="fs-4">
                                    <i class="fas fa-smile me-2"></i>
                                    <span class="badge {{ session.sentiment_label|sentiment_badge }} fs-6">ãƒã‚¸ãƒ†ã‚£ãƒ–</span>
                                </div>
                            </div>
                        {% elif session.sentiment_label == 'negative' %}
                            <div class="sentiment-score-large sentiment-negative">
                                <div>{{ session.overall_score|floatformat:3 }}</div>
                                <div class="fs-4">
                                    <i class="fas fa-frown me-2"></i>
                                    <span class="badge {{ session.sentiment_label|sentiment_badge }} fs-6">ãƒã‚¬ãƒ†ã‚£ãƒ–</span>
                                </div>
                            </div>
                        {% else %}
                            <div class="sentiment-score-large sentiment-neutral">
                                <div>{{ session.overall_score|floatformat:3 }}</div>
                                <div class="fs-4">
                                    <i class="fas fa-meh me-2"></i>
                                    <span class="badge {{ session.sentiment_label|sentiment_badge }} fs-6">ä¸­ç«‹</span>
                                </div>
                            </div>
                        {% endif %}
                    </div>
                    <div class="col-md-6">
                        <h6>ã‚¹ã‚³ã‚¢è§£é‡ˆ</h6>
                        <div class="small text-muted mb-3">
                            <div class="d-flex justify-content-between">
                                <span>-1.0</span>
                                <span>0.0</span>
                                <span>+1.0</span>
                            </div>
                            <div class="progress mb-2" style="height: 10px;">
                                <div class="progress-bar bg-danger" style="width: 50%"></div>
                                <div class="progress-bar bg-success" style="width: 50%"></div>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span>ãƒã‚¬ãƒ†ã‚£ãƒ–</span>
                                <span>ãƒã‚¸ãƒ†ã‚£ãƒ–</span>
                            </div>
                        </div>
                        
                        {% if session.overall_score > 0.5 %}
                            <div class="alert alert-success">
                                <i class="fas fa-thumbs-up me-2"></i>
                                éå¸¸ã«ãƒã‚¸ãƒ†ã‚£ãƒ–ãªå†…å®¹ã§ã™
                            </div>
                        {% elif session.overall_score > 0.2 %}
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle me-2"></i>
                                ã‚„ã‚„å‰å‘ããªå†…å®¹ã§ã™
                            </div>
                        {% elif session.overall_score < -0.5 %}
                            <div class="alert alert-danger">
                                <i class="fas fa-exclamation-triangle me-2"></i>
                                éå¸¸ã«ãƒã‚¬ãƒ†ã‚£ãƒ–ãªå†…å®¹ã§ã™
                            </div>
                        {% elif session.overall_score < -0.2 %}
                            <div class="alert alert-warning">
                                <i class="fas fa-minus-circle me-2"></i>
                                ã‚„ã‚„æ…é‡ãªå†…å®¹ã§ã™
                            </div>
                        {% else %}
                            <div class="alert alert-secondary">
                                <i class="fas fa-balance-scale me-2"></i>
                                ä¸­ç«‹çš„ãªå†…å®¹ã§ã™
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- è©³ç´°ãªã‚¹ã‚³ã‚¢å†…è¨³ -->
        {% if session.analysis_result.score_calculation %}
            {% with calc=session.analysis_result.score_calculation %}
                <div class="result-card card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-calculator me-2"></i>ã‚¹ã‚³ã‚¢è¨ˆç®—ã®è©³ç´°å†…è¨³
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="word-stats-grid">
                            <div class="word-stat-item">
                                <div class="h3 text-success mb-2">{{ calc.positive_scores|length }}</div>
                                <div class="text-muted small">ãƒã‚¸ãƒ†ã‚£ãƒ–èªæ•°</div>
                                {% if calc.positive_sum > 0 %}
                                    <div class="small text-success mt-1">åˆè¨ˆ: +{{ calc.positive_sum|floatformat:2 }}</div>
                                {% endif %}
                            </div>
                            
                            <div class="word-stat-item">
                                <div class="h3 text-danger mb-2">{{ calc.negative_scores|length }}</div>
                                <div class="text-muted small">ãƒã‚¬ãƒ†ã‚£ãƒ–èªæ•°</div>
                                {% if calc.negative_sum < 0 %}
                                    <div class="small text-danger mt-1">åˆè¨ˆ: {{ calc.negative_sum|floatformat:2 }}</div>
                                {% endif %}
                            </div>
                            
                            <div class="word-stat-item">
                                <div class="h3 text-primary mb-2">{{ calc.score_count }}</div>
                                <div class="text-muted small">ç·åˆ†æèªæ•°</div>
                                <div class="small text-primary mt-1">
                                    {% if session.analysis_result.statistics.unique_words_found %}
                                        (ãƒ¦ãƒ‹ãƒ¼ã‚¯: {{ session.analysis_result.statistics.unique_words_found }}èª)
                                    {% endif %}
                                </div>
                            </div>
                            
                            <div class="word-stat-item">
                                <div class="h3 text-info mb-2">{{ calc.final_score|floatformat:2 }}</div>
                                <div class="text-muted small">æœ€çµ‚ã‚¹ã‚³ã‚¢</div>
                                <div class="small text-info mt-1">
                                    å¹³å‡: {{ calc.average_score|floatformat:2 }}
                                </div>
                            </div>
                        </div>
                        
                        <div class="detailed-breakdown">
                            <h6 class="mb-3">
                                <i class="fas fa-chart-bar me-2"></i>è¨ˆç®—ãƒ—ãƒ­ã‚»ã‚¹
                            </h6>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="small mb-2">
                                        <strong>æ¤œå‡ºã•ã‚ŒãŸãƒã‚¸ãƒ†ã‚£ãƒ–èªå½™:</strong>
                                        {% for score in calc.positive_scores %}
                                            <span class="badge bg-success me-1">+{{ score|floatformat:1 }}</span>
                                        {% endfor %}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="small mb-2">
                                        <strong>æ¤œå‡ºã•ã‚ŒãŸãƒã‚¬ãƒ†ã‚£ãƒ–èªå½™:</strong>
                                        {% for score in calc.negative_scores %}
                                            <span class="badge bg-danger me-1">{{ score|floatformat:1 }}</span>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mt-3 p-3 bg-white rounded">
                                <div class="small">
                                    <strong>è¨ˆç®—å¼:</strong> 
                                    {% if calc.positive_sum != 0 and calc.negative_sum != 0 %}
                                        (ãƒã‚¸ãƒ†ã‚£ãƒ–åˆè¨ˆ: {{ calc.positive_sum|floatformat:2 }}) + (ãƒã‚¬ãƒ†ã‚£ãƒ–åˆè¨ˆ: {{ calc.negative_sum|floatformat:2 }}) = {{ session.overall_score|floatformat:2 }}
                                    {% elif calc.positive_sum != 0 %}
                                        ãƒã‚¸ãƒ†ã‚£ãƒ–èªå½™ã®ã¿: {{ calc.positive_sum|floatformat:2 }}
                                    {% elif calc.negative_sum != 0 %}
                                        ãƒã‚¬ãƒ†ã‚£ãƒ–èªå½™ã®ã¿: {{ calc.negative_sum|floatformat:2 }}
                                    {% else %}
                                        æ„Ÿæƒ…èªå½™ãªã—: 0.0
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            {% endwith %}
        {% endif %}

        <!-- åˆ¤å®šã•ã‚ŒãŸæ–‡ç« ã®è©³ç´°è¡¨ç¤º -->
        {% if session.analysis_result.sample_sentences %}

            {% with samples=session.analysis_result.sample_sentences %}
                <div class="result-card card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-file-text me-2"></i>åˆ¤å®šã•ã‚ŒãŸæ–‡ç« ã®è©³ç´°
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="sentence-analysis-section">
                            {% if samples.positive %}
                                <div class="mb-4">
                                    <h6 class="text-success">
                                        <i class="fas fa-smile me-2"></i>ãƒã‚¸ãƒ†ã‚£ãƒ–ã¨åˆ¤å®šã•ã‚ŒãŸæ–‡ç«  ({{ samples.positive|length }}ä»¶)
                                    </h6>
                                    {% for sentence in samples.positive %}
                                        <div class="analyzed-sentence positive">
                                            <div class="d-flex justify-content-between align-items-start mb-2">
                                                <div class="fw-semibold text-success">
                                                    <span class="impact-indicator impact-{% if sentence.score > 0.7 %}high{% elif sentence.score > 0.4 %}medium{% else %}low{% endif %}"></span>
                                                    ã‚¹ã‚³ã‚¢: {{ sentence.score|floatformat:2 }}
                                                </div>
                                                <div class="small text-muted">
                                                    {% if sentence.score > 0.7 %}
                                                        å¼·ã„ãƒã‚¸ãƒ†ã‚£ãƒ–
                                                    {% elif sentence.score > 0.4 %}
                                                        ä¸­ç¨‹åº¦ã®ãƒã‚¸ãƒ†ã‚£ãƒ–
                                                    {% else %}
                                                        è»½å¾®ãªãƒã‚¸ãƒ†ã‚£ãƒ–
                                                    {% endif %}
                                                </div>
                                            </div>
                                            <div class="mb-2">
                                                {% if sentence.keywords %}
                                                    {% for keyword in sentence.keywords %}
                                                        {% with highlighted_text=sentence.text|highlight_keywords:keyword %}
                                                            {{ highlighted_text|safe }}
                                                        {% endwith %}
                                                    {% endfor %}
                                                {% else %}
                                                    {{ sentence.text }}
                                                {% endif %}
                                            </div>
                                            {% if sentence.keywords %}
                                                <div class="small text-muted">
                                                    <strong>æ¤œå‡ºã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰:</strong> 
                                                    {% for keyword in sentence.keywords %}
                                                        <span class="badge bg-success me-1">{{ keyword }}</span>
                                                    {% endfor %}
                                                </div>
                                            {% endif %}
                                        </div>
                                    {% endfor %}
                                </div>
                            {% endif %}
                            
                            {% if samples.negative %}
                                <div class="mb-4">
                                    <h6 class="text-danger">
                                        <i class="fas fa-frown me-2"></i>ãƒã‚¬ãƒ†ã‚£ãƒ–ã¨åˆ¤å®šã•ã‚ŒãŸæ–‡ç«  ({{ samples.negative|length }}ä»¶)
                                    </h6>
                                    {% for sentence in samples.negative %}
                                        <div class="analyzed-sentence negative">
                                            <div class="d-flex justify-content-between align-items-start mb-2">
                                                <div class="fw-semibold text-danger">
                                                    <span class="impact-indicator impact-{% if sentence.score < -0.7 %}high{% elif sentence.score < -0.4 %}medium{% else %}low{% endif %}"></span>
                                                    ã‚¹ã‚³ã‚¢: {{ sentence.score|floatformat:2 }}
                                                </div>
                                                <div class="small text-muted">
                                                    {% if sentence.score < -0.7 %}
                                                        å¼·ã„ãƒã‚¬ãƒ†ã‚£ãƒ–
                                                    {% elif sentence.score < -0.4 %}
                                                        ä¸­ç¨‹åº¦ã®ãƒã‚¬ãƒ†ã‚£ãƒ–
                                                    {% else %}
                                                        è»½å¾®ãªãƒã‚¬ãƒ†ã‚£ãƒ–
                                                    {% endif %}
                                                </div>
                                            </div>
                                            <div class="mb-2">
                                                {% if sentence.keywords %}
                                                    {% for keyword in sentence.keywords %}
                                                        {% with highlighted_text=sentence.text|highlight_keywords:keyword %}
                                                            {{ highlighted_text|safe }}
                                                        {% endwith %}
                                                    {% endfor %}
                                                {% else %}
                                                    {{ sentence.text }}
                                                {% endif %}
                                            </div>
                                            {% if sentence.keywords %}
                                                <div class="small text-muted">
                                                    <strong>æ¤œå‡ºã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰:</strong> 
                                                    {% for keyword in sentence.keywords %}
                                                        <span class="badge bg-danger me-1">{{ keyword }}</span>
                                                    {% endfor %}
                                                </div>
                                            {% endif %}
                                        </div>
                                    {% endfor %}
                                </div>
                            {% endif %}
                            
                            {% if not samples.positive and not samples.negative %}
                                <div class="text-center py-4">
                                    <i class="fas fa-search fa-3x text-muted mb-3"></i>
                                    <h5 class="text-muted">ç‰¹å¾´çš„ãªæ–‡ç« ã¯æ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ</h5>
                                    <p class="text-muted">æ„Ÿæƒ…ã‚¹ã‚³ã‚¢ãŒé–¾å€¤ã‚’è¶…ãˆã‚‹æ–‡ç« ãŒã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸ</p>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% endwith %}
        {% endif %}

        <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘è¦‹è§£ãƒ»ææ¡ˆ -->
        <div class="result-card card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-lightbulb me-2"></i>åˆ†æã‹ã‚‰èª­ã¿å–ã‚Œã‚‹è¦‹è§£
                </h5>
            </div>
            <div class="card-body">
                {% if formatted_insights %}
                    <!-- å¸‚å ´ã¸ã®å½±éŸ¿ -->
                    {% if formatted_insights.market_implications %}
                        <div class="insight-card mb-4">
                            <h6 class="text-primary mb-3">
                                <i class="fas fa-chart-line me-2"></i>å¸‚å ´ã¸ã®å½±éŸ¿åˆ†æ
                            </h6>
                            {% if formatted_insights.market_implications.sentiment %}
                                <p><strong>å¸‚å ´ã®åå¿œäºˆæƒ³:</strong> {{ formatted_insights.market_implications.sentiment }}</p>
                            {% endif %}
                            {% if formatted_insights.market_implications.stock_impact %}
                                <p><strong>æ ªä¾¡ã¸ã®å½±éŸ¿:</strong> {{ formatted_insights.market_implications.stock_impact }}</p>
                            {% endif %}
                        </div>
                    {% endif %}
                    
                    <!-- çµŒå–¶æˆ¦ç•¥ã®èª­ã¿å–ã‚Š -->
                    {% if formatted_insights.strategy_reading %}
                        <div class="insight-card mb-4">
                            <h6 class="text-success mb-3">
                                <i class="fas fa-chess me-2"></i>çµŒå–¶æˆ¦ç•¥ã®èª­ã¿å–ã‚Š
                            </h6>
                            {% if formatted_insights.strategy_reading.management_stance %}
                                <p><strong>çµŒå–¶ã‚¹ã‚¿ãƒ³ã‚¹:</strong> {{ formatted_insights.strategy_reading.management_stance }}</p>
                            {% endif %}
                            {% if formatted_insights.strategy_reading.strategic_direction %}
                                <p><strong>æˆ¦ç•¥çš„æ–¹å‘æ€§:</strong> {{ formatted_insights.strategy_reading.strategic_direction }}</p>
                            {% endif %}
                        </div>
                    {% endif %}
                    
                    <!-- æŠ•è³‡å®¶è¦–ç‚¹ -->
                    {% if formatted_insights.investor_perspective %}
                        <div class="insight-card mb-4">
                            <h6 class="text-info mb-3">
                                <i class="fas fa-user-tie me-2"></i>æŠ•è³‡å®¶è¦–ç‚¹ã§ã®è©•ä¾¡
                            </h6>
                            {% if formatted_insights.investor_perspective.investment_appeal %}
                                <p><strong>æŠ•è³‡é­…åŠ›åº¦:</strong> {{ formatted_insights.investor_perspective.investment_appeal }}</p>
                            {% endif %}
                            {% if formatted_insights.investor_perspective.growth_potential %}
                                <p><strong>æˆé•·ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«:</strong> {{ formatted_insights.investor_perspective.growth_potential }}</p>
                            {% endif %}
                            {% if formatted_insights.investor_perspective.dividend_outlook %}
                                <p><strong>é…å½“è¦‹é€šã—:</strong> {{ formatted_insights.investor_perspective.dividend_outlook }}</p>
                            {% endif %}
                        </div>
                    {% endif %}
                    
                    <!-- ãƒªã‚¹ã‚¯è©•ä¾¡ -->
                    {% if formatted_insights.risk_assessment %}
                        <div class="insight-card mb-4">
                            <h6 class="text-warning mb-3">
                                <i class="fas fa-shield-alt me-2"></i>ãƒªã‚¹ã‚¯è©•ä¾¡
                            </h6>
                            <p><strong>ãƒªã‚¹ã‚¯ãƒ¬ãƒ™ãƒ«:</strong> 
                                {% if formatted_insights.risk_assessment.risk_level == 'high' %}
                                    <span class="badge bg-danger">é«˜</span>
                                {% elif formatted_insights.risk_assessment.risk_level == 'medium' %}
                                    <span class="badge bg-warning">ä¸­</span>
                                {% else %}
                                    <span class="badge bg-success">ä½</span>
                                {% endif %}
                            </p>
                            {% if formatted_insights.risk_assessment.identified_risks %}
                                <p><strong>ç‰¹å®šã•ã‚ŒãŸãƒªã‚¹ã‚¯:</strong></p>
                                <ul class="small">
                                    {% for risk in formatted_insights.risk_assessment.identified_risks %}
                                        <li>{{ risk }}</li>
                                    {% endfor %}
                                </ul>
                            {% endif %}
                            {% if formatted_insights.risk_assessment.monitoring_points %}
                                <p><strong>ç›£è¦–ãƒã‚¤ãƒ³ãƒˆ:</strong></p>
                                <ul class="small">
                                    {% for point in formatted_insights.risk_assessment.monitoring_points %}
                                        <li>{{ point }}</li>
                                    {% endfor %}
                                </ul>
                            {% endif %}
                        </div>
                    {% endif %}
                    
                    <!-- å°†æ¥å±•æœ› -->
                    {% if formatted_insights.future_outlook %}
                        <div class="insight-card mb-4">
                            <h6 class="text-purple mb-3">
                                <i class="fas fa-crystal-ball me-2"></i>å°†æ¥å±•æœ›
                            </h6>
                            {% if formatted_insights.future_outlook.short_term %}
                                <p><strong>çŸ­æœŸè¦‹é€šã—:</strong> {{ formatted_insights.future_outlook.short_term }}</p>
                            {% endif %}
                            {% if formatted_insights.future_outlook.medium_term %}
                                <p><strong>ä¸­æœŸæˆ¦ç•¥:</strong> {{ formatted_insights.future_outlook.medium_term }}</p>
                            {% endif %}
                            {% if formatted_insights.future_outlook.long_term %}
                                <p><strong>é•·æœŸãƒ“ã‚¸ãƒ§ãƒ³:</strong> {{ formatted_insights.future_outlook.long_term }}</p>
                            {% endif %}
                        </div>
                    {% endif %}
                    
                    <!-- ã‚¹ãƒ†ãƒ¼ã‚¯ãƒ›ãƒ«ãƒ€ãƒ¼åˆ¥æ¨å¥¨äº‹é … -->
                    {% if formatted_insights.recommendations %}
                        <div class="insight-suggestion">
                            <h6 class="text-primary mb-3">
                                <i class="fas fa-users me-2"></i>ã‚¹ãƒ†ãƒ¼ã‚¯ãƒ›ãƒ«ãƒ€ãƒ¼åˆ¥æ¨å¥¨äº‹é …
                            </h6>
                            
                            {% if formatted_insights.recommendations.investors %}
                                <div class="mb-3">
                                    <strong class="text-primary">æŠ•è³‡å®¶å‘ã‘:</strong>
                                    <ul class="recommendation-list">
                                        {% for recommendation in formatted_insights.recommendations.investors %}
                                            <li>{{ recommendation }}</li>
                                        {% endfor %}
                                    </ul>
                                </div>
                            {% endif %}
                            
                            {% if formatted_insights.recommendations.management %}
                                <div class="mb-3">
                                    <strong class="text-success">çµŒå–¶é™£å‘ã‘:</strong>
                                    <ul class="recommendation-list">
                                        {% for recommendation in formatted_insights.recommendations.management %}
                                            <li>{{ recommendation }}</li>
                                        {% endfor %}
                                    </ul>
                                </div>
                            {% endif %}
                        </div>
                    {% endif %}
                    
                {% else %}
                    <!-- ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼šåŸºæœ¬çš„ãªè¦‹è§£ -->
                    <div class="insight-card">
                        <h6 class="text-primary mb-3">
                            <i class="fas fa-chart-line me-2"></i>å…¨ä½“çš„ãªå‚¾å‘
                        </h6>
                        {% if session.sentiment_label == 'positive' %}
                            <p>ã“ã®æ›¸é¡ã‹ã‚‰ã¯<strong>å‰å‘ããªçµŒå–¶å§¿å‹¢</strong>ãŒèª­ã¿å–ã‚Œã¾ã™ã€‚</p>
                            {% if session.overall_score > 0.6 %}
                                <p>ç‰¹ã«ã€æˆé•·ã¸ã®æ„æ¬²ã‚„åç›Šæ”¹å–„ã¸ã®å–ã‚Šçµ„ã¿ãŒå¼·ãè¡¨ç¾ã•ã‚Œã¦ãŠã‚Šã€æŠ•è³‡å®¶ã«ã¨ã£ã¦å®‰å¿ƒæ„Ÿã‚’ä¸ãˆã‚‹å†…å®¹ã¨ãªã£ã¦ã„ã¾ã™ã€‚</p>
                            {% endif %}
                        {% elif session.sentiment_label == 'negative' %}
                            <p>ã“ã®æ›¸é¡ã‹ã‚‰ã¯<strong>æ…é‡ãªçµŒå–¶ã‚¹ã‚¿ãƒ³ã‚¹</strong>ã‚„<strong>èª²é¡Œã¸ã®è¨€åŠ</strong>ãŒå¤šãè¦‹ã‚‰ã‚Œã¾ã™ã€‚</p>
                            {% if session.overall_score < -0.6 %}
                                <p>ãƒªã‚¹ã‚¯ã‚„å›°é›£ãªçŠ¶æ³ã«ã¤ã„ã¦ã®è¨˜è¿°ãŒç›®ç«‹ã¡ã¾ã™ãŒã€ã“ã‚Œã¯ä¼æ¥­ã®é€æ˜æ€§ã®è¡¨ã‚Œã¨ã‚‚æ‰ãˆã‚‰ã‚Œã¾ã™ã€‚</p>
                            {% endif %}
                        {% else %}
                            <p>ã“ã®æ›¸é¡ã¯<strong>ãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸå†…å®¹</strong>ã¨ãªã£ã¦ãŠã‚Šã€å®¢è¦³çš„ãªå ±å‘ŠãŒä¸»ä½“ã¨ãªã£ã¦ã„ã¾ã™ã€‚</p>
                        {% endif %}
                    </div>
                {% endif %}
                
                <!-- æ¥­ç•Œæ¯”è¼ƒ -->
                {% if industry_stats %}
                    <div class="alert alert-info">
                        <h6 class="alert-heading">
                            <i class="fas fa-industry me-2"></i>æ¥­ç•Œæ¯”è¼ƒ
                        </h6>
                        <p class="mb-1">{{ industry_stats.comparison_text }}</p>
                        <small>åŒç¨®æ›¸é¡{{ industry_stats.industry_count }}ä»¶ã¨ã®æ¯”è¼ƒï¼ˆä¸Šä½{{ industry_stats.percentile }}%ï¼‰</small>
                    </div>
                {% endif %}
                
                <!-- ä¿¡é ¼æ€§è©•ä¾¡ -->
                {% if reliability_score %}
                    <div class="alert {% if reliability_score.level == 'very_high' or reliability_score.level == 'high' %}alert-success{% elif reliability_score.level == 'medium' %}alert-warning{% else %}alert-secondary{% endif %}">
                        <h6 class="alert-heading">
                            <i class="fas fa-shield-check me-2"></i>åˆ†æã®ä¿¡é ¼æ€§è©•ä¾¡
                        </h6>
                        <p class="mb-2">{{ reliability_score.description }}</p>
                        <div class="progress mb-2" style="height: 10px;">
                            <div class="progress-bar {% if reliability_score.score >= 80 %}bg-success{% elif reliability_score.score >= 60 %}bg-info{% elif reliability_score.score >= 40 %}bg-warning{% else %}bg-secondary{% endif %}" 
                                 style="width: {{ reliability_score.score|score_percentage }}%">
                                {{ reliability_score.score|score_percentage }}%
                            </div>
                        </div>
                        {% if reliability_score.factors %}
                            <small>æ ¹æ‹ : {{ reliability_score.factors|join:"ã€" }}</small>
                        {% endif %}
                    </div>
                {% endif %}
                
                <div class="alert alert-info">
                    <i class="fas fa-exclamation-circle me-2"></i>
                    <strong>æ³¨æ„äº‹é …:</strong> 
                    ã“ã®æ„Ÿæƒ…åˆ†æã¯æ–‡æ›¸ã®è¡¨ç¾ã‚’æ©Ÿæ¢°çš„ã«åˆ†æã—ãŸã‚‚ã®ã§ã™ã€‚æŠ•è³‡åˆ¤æ–­ã‚„çµŒå–¶åˆ¤æ–­ã‚’è¡Œã†éš›ã¯ã€è²¡å‹™ãƒ‡ãƒ¼ã‚¿ã‚„å¸‚å ´ç’°å¢ƒãªã©ä»–ã®è¦å› ã‚‚ç·åˆçš„ã«æ¤œè¨ã—ã¦ãã ã•ã„ã€‚
                </div>
            </div>
        </div>
    </div>
    
    <!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼ -->
    <div class="col-lg-4">
        <!-- çµ±è¨ˆæƒ…å ± -->
        {% if session.analysis_result.statistics %}
            {% with stats=session.analysis_result.statistics %}
                <div class="result-card card">
                    <div class="card-header">
                        <h6 class="mb-0">
                            <i class="fas fa-chart-bar me-2"></i>åˆ†æçµ±è¨ˆ
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="row text-center">
                            <div class="col-6 mb-3">
                                <div class="h4 text-primary">{{ stats.total_words_analyzed }}</div>
                                <div class="small text-muted">åˆ†æã—ãŸèªæ•°</div>
                            </div>
                            <div class="col-6 mb-3">
                                <div class="h4 text-info">{{ stats.context_patterns_found }}</div>
                                <div class="small text-muted">æ–‡è„ˆãƒ‘ã‚¿ãƒ¼ãƒ³</div>
                            </div>
                            <div class="col-6 mb-3">
                                <div class="h4 text-success">{{ stats.basic_words_found }}</div>
                                <div class="small text-muted">åŸºæœ¬èªå½™</div>
                            </div>
                            <div class="col-6 mb-3">
                                <div class="h4 text-secondary">{{ stats.sentences_analyzed }}</div>
                                <div class="small text-muted">åˆ†ææ–‡æ•°</div>
                            </div>
                        </div>
                        
                        <div class="small text-muted">
                            <div class="mb-2">
                                <strong>æ–‡è„ˆãƒ‘ã‚¿ãƒ¼ãƒ³:</strong> ã€Œæ¸›åã®æ”¹å–„ã€ã®ã‚ˆã†ãªè¤‡åˆè¡¨ç¾
                            </div>
                            <div>
                                <strong>åŸºæœ¬èªå½™:</strong> è¾æ›¸ã«ç™»éŒ²ã•ã‚ŒãŸå€‹åˆ¥ã®èª
                            </div>
                        </div>
                    </div>
                </div>
            {% endwith %}
        {% endif %}
        
        <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="result-card card">
            <div class="card-header">
                <h6 class="mb-0">
                    <i class="fas fa-tools me-2"></i>ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
                </h6>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <a href="{% url 'earnings_analysis:sentiment-analysis' document.doc_id %}" 
                       class="btn btn-primary">
                        <i class="fas fa-redo me-1"></i>å†åˆ†æå®Ÿè¡Œ
                    </a>
                    <a href="{% url 'earnings_analysis:document-detail-ui' document.doc_id %}" 
                       class="btn btn-outline-secondary">
                        <i class="fas fa-arrow-left me-1"></i>æ›¸é¡è©³ç´°ã«æˆ»ã‚‹
                    </a>
                    <button type="button" class="btn btn-outline-info" onclick="shareResult()">
                        <i class="fas fa-share me-1"></i>çµæœã‚’å…±æœ‰
                    </button>
                    <button type="button" class="btn btn-outline-success" onclick="exportSummary()">
                        <i class="fas fa-download me-1"></i>ã‚µãƒãƒªãƒ¼ã‚’ä¿å­˜
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function shareResult() {
    const url = window.location.href;
    const title = `æ„Ÿæƒ…åˆ†æçµæœ: {{ document.company_name }} (ã‚¹ã‚³ã‚¢: {{ session.overall_score|floatformat:2 }})`;
    
    if (navigator.share) {
        navigator.share({
            title: title,
            url: url
        }).catch(console.error);
    } else if (navigator.clipboard) {
        navigator.clipboard.writeText(url).then(() => {
            alert('URLã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ');
        });
    } else {
        prompt('URLã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„:', url);
    }
}

function exportSummary() {
    const summary = {
        company: '{{ document.company_name }}',
        document: '{{ document.doc_description }}',
        analysis_date: '{{ session.created_at|date:"Y-m-d H:i:s" }}',
        overall_score: {{ session.overall_score }},
        sentiment_label: '{{ session.sentiment_label }}',
        positive_words: {{ session.analysis_result.score_calculation.positive_scores|length }},
        negative_words: {{ session.analysis_result.score_calculation.negative_scores|length }},
        total_analyzed_words: {{ session.analysis_result.statistics.total_words_analyzed }},
        key_insights: [
            {% if session.sentiment_label == 'positive' %}
                'å‰å‘ããªçµŒå–¶å§¿å‹¢ãŒè¡¨ã‚Œã¦ã„ã‚‹',
                'æˆé•·ã¸ã®æœŸå¾…ãŒæŒã¦ã‚‹å†…å®¹'
            {% elif session.sentiment_label == 'negative' %}
                'ãƒªã‚¹ã‚¯ã‚„èª²é¡Œã¸ã®è¨€åŠãŒå¤šã„',
                'æ…é‡ãªçµŒå–¶ã‚¹ã‚¿ãƒ³ã‚¹'
            {% else %}
                'ãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸå®¢è¦³çš„ãªå†…å®¹',
                'å®‰å®šã—ãŸçŠ¶æ³ã‚’ç¤ºã—ã¦ã„ã‚‹'
            {% endif %}
        ]
    };
    
    const blob = new Blob([JSON.stringify(summary, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `sentiment_analysis_${summary.company}_${summary.analysis_date.replace(/[: ]/g, '_')}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}

// ã‚¹ãƒ ãƒ¼ã‚ºã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
document.addEventListener('DOMContentLoaded', function() {
    // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒã‚¤ãƒ©ã‚¤ãƒˆã®ãƒ›ãƒãƒ¼åŠ¹æœ
    document.querySelectorAll('.keyword-highlight').forEach(el => {
        el.addEventListener('mouseenter', function() {
            this.style.transform = 'scale(1.05)';
            this.style.transition = 'transform 0.2s ease';
        });
        
        el.addEventListener('mouseleave', function() {
            this.style.transform = 'scale(1)';
        });
    });
    
    // åˆ†æçµæœã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
    const cards = document.querySelectorAll('.result-card');
    const observer = new IntersectionObserver(entries => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.opacity = '1';
                entry.target.style.transform = 'translateY(0)';
            }
        });
    });
    
    cards.forEach(card => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        card.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
        observer.observe(card);
    });
});
</script>
{% endblock %}