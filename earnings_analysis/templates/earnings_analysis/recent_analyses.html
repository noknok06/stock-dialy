{% for analysis in recent_analyses %}
<div class="card analysis-result-card mb-3">
  <div class="card-body">
    <div class="row">
      <div class="col-md-8">
        <h5 class="card-title mb-2">
          <strong>{{ analysis.company.company_name }}</strong>
          <span class="text-muted">({{ analysis.company.company_code }})</span>
        </h5>
        <p class="text-muted mb-2">
          <i class="bi bi-calendar me-1"></i>
          {{ analysis.analysis_date|date:"Y年m月d日" }}
          <span class="ms-3">
            <i class="bi bi-file-text me-1"></i>
            {{ analysis.report.fiscal_year }} {{ analysis.report.quarter }}
          </span>
        </p>
        
        {% if analysis.sentiment_analysis %}
        <div class="row mt-3">
          <div class="col-md-6">
            <div class="d-flex align-items-center">
              <span class="me-2">感情スコア:</span>
              <span class="sentiment-score {% if analysis.sentiment_analysis.sentiment_score > 0 %}sentiment-positive{% elif analysis.sentiment_analysis.sentiment_score < -20 %}sentiment-negative{% else %}sentiment-neutral{% endif %}">
                {{ analysis.sentiment_analysis.sentiment_score|floatformat:1 }}
              </span>
            </div>
          </div>
          <div class="col-md-6">
            <span class="badge confidence-badge bg-{% if analysis.sentiment_analysis.confidence_level == 'very_high' or analysis.sentiment_analysis.confidence_level == 'high' %}success{% elif analysis.sentiment_analysis.confidence_level == 'very_low' or analysis.sentiment_analysis.confidence_level == 'low' %}danger{% else %}primary{% endif %}">
              経営陣自信度: {{ analysis.sentiment_analysis.get_confidence_level_display }}
            </span>
          </div>
        </div>
        
        <!-- キャッシュフロー情報があれば表示 -->
        {% if analysis.cashflow_analysis %}
        <div class="row mt-2">
          <div class="col-md-6">
            <small class="text-muted">
              CFパターン: 
              <span class="badge cf-pattern-badge cf-{{ analysis.cashflow_analysis.cf_pattern }}">
                {{ analysis.cashflow_analysis.get_cf_pattern_display }}
              </span>
            </small>
          </div>
          <div class="col-md-6">
            <small class="text-muted">
              健全性: 
              <span class="badge bg-{% if analysis.cashflow_analysis.health_score == 'excellent' %}success{% elif analysis.cashflow_analysis.health_score == 'good' %}primary{% elif analysis.cashflow_analysis.health_score == 'fair' %}warning{% else %}danger{% endif %}">
                {{ analysis.cashflow_analysis.get_health_score_display }}
              </span>
            </small>
          </div>
        </div>
        {% endif %}
        {% endif %}
      </div>
      <div class="col-md-4 text-md-end">
        <button class="btn btn-outline-primary btn-sm mb-2" 
                hx-get="{% url 'earnings_analysis:analysis_detail' analysis.company.company_code %}"
                hx-target="#detailModalBody"
                onclick="new bootstrap.Modal(document.getElementById('detailModal')).show()">
          <i class="bi bi-eye me-1"></i>詳細を見る
        </button>
        <br>
        <button class="btn btn-primary btn-sm" 
                onclick="refreshAnalysis('{{ analysis.company.company_code }}')">
          <i class="bi bi-arrow-clockwise me-1"></i>再分析
        </button>
      </div>
    </div>
  </div>
</div>
{% empty %}
<div class="text-center py-5">
  <i class="bi bi-graph-up-arrow" style="font-size: 3rem; color: var(--text-light);"></i>
  <h4 class="mt-3 text-muted">まだ分析結果がありません</h4>
  <p class="text-muted">企業を検索して分析を開始してください</p>
  <button class="btn btn-primary" onclick="showSearchModal()">
    <i class="bi bi-search me-2"></i>企業を検索
  </button>
</div>
{% endfor %}

{% if error %}
<div class="alert alert-warning" role="alert">
  <i class="bi bi-exclamation-triangle me-2"></i>
  分析結果の読み込み中にエラーが発生しました: {{ error }}
</div>
{% endif %}

<style>
.sentiment-score {
  font-size: 1.25rem;
  font-weight: bold;
}

.sentiment-positive { color: var(--success-color); }
.sentiment-negative { color: var(--danger-color); }
.sentiment-neutral { color: var(--info-color); }

.confidence-badge {
  font-size: 0.8rem;
  padding: 0.35em 0.75em;
}

.cf-pattern-badge {
  padding: 0.25em 0.5em;
  font-size: 0.7em;
  border-radius: 0.25rem;
}

.cf-ideal { 
  background-color: var(--success-color);
  color: white;
}
.cf-growth { 
  background-color: var(--primary-color);
  color: white;
}
.cf-danger { 
  background-color: var(--danger-color);
  color: white;
}
.cf-recovery { 
  background-color: var(--warning-color);
  color: white;
}
.cf-restructuring { 
  background-color: var(--info-color);
  color: white;
}
.cf-unknown { 
  background-color: var(--text-light);
  color: white;
}

.analysis-result-card {
  border-left: 4px solid var(--primary-color);
  transition: all 0.3s ease;
}

.analysis-result-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(0,0,0,0.1);
}
</style>