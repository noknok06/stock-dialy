{% extends 'base.html' %}
{% load static %}

{% block title %}ä¼æ¥­é¸æŠ - {{ template.name }} - ã‚«ãƒ–ãƒ­ã‚°{% endblock %}

{% block content %}
<div class="container mt-4 mb-5">
    <!-- ãƒšãƒ¼ã‚¸ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <div class="page-header mb-4">
        <nav aria-label="breadcrumb" class="mb-2">
            <ol class="breadcrumb mb-0">
                <li class="breadcrumb-item"><a href="{% url 'analysis_template:list' %}">ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä¸€è¦§</a></li>
                <li class="breadcrumb-item"><a href="{% url 'analysis_template:detail' template.pk %}">{{ template.name }}</a></li>
                <li class="breadcrumb-item active" aria-current="page">ä¼æ¥­é¸æŠ</li>
            </ol>
        </nav>
        <h1 class="page-title">
            <i class="bi bi-building"></i>
            <span class="page-title-text">ä¼æ¥­é¸æŠ</span>
        </h1>
        <p class="page-subtitle">
            è¤‡æ•°ã®ä¼æ¥­ã‚’é¸æŠã—ã¦ã‹ã‚‰ã€ã¾ã¨ã‚ã¦ç™»éŒ²ã§ãã¾ã™
        </p>
    </div>

    <div class="row">
        <!-- å·¦å´: ä¼æ¥­æ¤œç´¢ãƒ»é¸æŠ -->
        <div class="col-lg-8 mb-4">
            <!-- æ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ  -->
            <div class="card border-0 shadow-sm mb-3">
                <div class="card-body">
                    <form method="get" class="row g-3" id="searchForm">
                        <div class="col-md-6">
                            {{ search_form.query }}
                        </div>
                        <div class="col-md-3">
                            {{ search_form.industry }}
                        </div>
                        <div class="col-md-3">
                            {{ search_form.market }}
                        </div>
                        <div class="col-12">
                            <button type="submit" class="btn btn-primary" onclick="saveBeforeSearch()">
                                <i class="bi bi-search me-1"></i>æ¤œç´¢
                            </button>
                            <button type="button" class="btn btn-outline-secondary ms-2" onclick="resetSearch()">
                                <i class="bi bi-arrow-clockwise me-1"></i>ãƒªã‚»ãƒƒãƒˆ
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- ä¼æ¥­ãƒªã‚¹ãƒˆ -->
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-transparent">
                    <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
                        <h6 class="mb-0">
                            ä¼æ¥­ä¸€è¦§
                            <small class="text-muted ms-2">ï¼ˆã“ã®ãƒšãƒ¼ã‚¸ã®ã¿ã‚’å…¨é¸æŠï¼‰</small>
                        </h6>
                        <div class="d-flex gap-2 align-items-center flex-wrap">
                            <span class="badge bg-primary fs-6" id="selectionCount">0</span>
                            <button type="button" class="btn btn-sm btn-outline-warning" onclick="selectAllOnPage()">
                                <i class="bi bi-check-square me-1"></i>ã“ã®ãƒšãƒ¼ã‚¸ã‚’å…¨é¸æŠ
                            </button>
                            <button type="button" class="btn btn-sm btn-outline-danger" onclick="clearAllSelections()">
                                <i class="bi bi-x-circle me-1"></i>ã™ã¹ã¦ã‚¯ãƒªã‚¢
                            </button>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <form method="post" id="companySelectForm">
                        {% csrf_token %}
                        
                        {# ã‚¢ã‚¯ã‚·ãƒ§ãƒ³é¸æŠç”¨ã®éš ã—ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ #}
                        <input type="hidden" name="action" id="actionInput" value="add">
                        
                        <!-- é¸æŠã—ãŸä¼æ¥­ã‚³ãƒ¼ãƒ‰ã‚’ä¿æŒã™ã‚‹éš ã—ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆå‹•çš„ã«è¿½åŠ ï¼‰ -->
                        <div id="hiddenInputsContainer"></div>
                        
                        <div class="table-responsive">
                            <table class="table table-hover align-middle">
                                <thead>
                                    <tr>
                                        <th style="width: 50px;">é¸æŠ</th>
                                        <th>ã‚³ãƒ¼ãƒ‰</th>
                                        <th>éŠ˜æŸ„å</th>
                                        <th>æ¥­ç¨®</th>
                                        <th>å¸‚å ´</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for company in page_obj %}
                                    <tr data-company-code="{{ company.code }}" class="company-row">
                                        <td>
                                            <input type="checkbox" 
                                                   value="{{ company.code }}"
                                                   class="form-check-input company-checkbox"
                                                   data-company-code="{{ company.code }}"
                                                   data-company-name="{{ company.name }}">
                                        </td>
                                        <td class="fw-medium">{{ company.code }}</td>
                                        <td>
                                            {{ company.name }}
                                            <span class="badge bg-success ms-2 selected-badge d-none">âœ“</span>
                                        </td>
                                        <td><small class="text-muted">{{ company.industry_name_33|default:"-" }}</small></td>
                                        <td><small class="text-muted">{{ company.market|default:"-" }}</small></td>
                                    </tr>
                                    {% empty %}
                                    <tr>
                                        <td colspan="5" class="text-center text-muted py-4">
                                            è©²å½“ã™ã‚‹ä¼æ¥­ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>

                        <!-- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ -->
                        {% if page_obj.has_other_pages %}
                        <nav aria-label="ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³" class="mt-3">
                            <ul class="pagination pagination-sm justify-content-center mb-0">
                                {% if page_obj.has_previous %}
                                <li class="page-item">
                                    <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if request.GET.query %}&query={{ request.GET.query }}{% endif %}{% if request.GET.industry %}&industry={{ request.GET.industry }}{% endif %}{% if request.GET.market %}&market={{ request.GET.market }}{% endif %}" onclick="saveBeforeNavigate(event)">
                                        <i class="bi bi-chevron-left"></i>
                                    </a>
                                </li>
                                {% endif %}
                                
                                <li class="page-item active">
                                    <span class="page-link">
                                        {{ page_obj.number }} / {{ page_obj.paginator.num_pages }}
                                    </span>
                                </li>
                                
                                {% if page_obj.has_next %}
                                <li class="page-item">
                                    <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if request.GET.query %}&query={{ request.GET.query }}{% endif %}{% if request.GET.industry %}&industry={{ request.GET.industry }}{% endif %}{% if request.GET.market %}&market={{ request.GET.market }}{% endif %}" onclick="saveBeforeNavigate(event)">
                                        <i class="bi bi-chevron-right"></i>
                                    </a>
                                </li>
                                {% endif %}
                            </ul>
                        </nav>
                        {% endif %}

                        {# ãƒœã‚¿ãƒ³ #}
                        <div class="d-flex gap-2 justify-content-end mt-3 flex-wrap">
                            <a href="{% url 'analysis_template:detail' template.pk %}" class="btn btn-secondary">
                                <i class="bi bi-x-circle me-1"></i>ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                            </a>
                            <button type="button" class="btn btn-success" onclick="submitForm('add')">
                                <i class="bi bi-plus-circle me-1"></i>é¸æŠä¼æ¥­ã‚’è¿½åŠ 
                            </button>
                            <button type="button" class="btn btn-primary" onclick="submitForm('replace')">
                                <i class="bi bi-check-circle me-1"></i>é¸æŠä¼æ¥­ã§ç½®ãæ›ãˆ
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- å³å´: é¸æŠæ¸ˆã¿ä¼æ¥­ -->
        <div class="col-lg-4">
            <div class="card border-0 shadow-sm sticky-top" style="top: 1rem;">
                <div class="card-header bg-transparent">
                    <h6 class="mb-0">
                        <i class="bi bi-check-circle me-1"></i>é¸æŠæ¸ˆã¿ä¼æ¥­
                        <span class="badge bg-primary ms-2" id="selectedCount">0</span>
                    </h6>
                </div>
                <div class="card-body" style="max-height: 400px; overflow-y: auto;">
                    <div id="selectedCompaniesList">
                        <div class="text-center text-muted py-4" id="emptyState">
                            <i class="bi bi-inbox" style="font-size: 2rem;"></i>
                            <p class="mb-0 mt-2 small">ä¼æ¥­ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“</p>
                            <p class="mb-0 text-muted" style="font-size: 0.75rem;">
                                ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’é¸æŠã—ã¦ãã ã•ã„
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            
            {# èª¬æ˜ #}
            <div class="card border-0 shadow-sm mt-3">
                <div class="card-body">
                    <h6 class="card-title">
                        <i class="bi bi-info-circle text-primary me-1"></i>
                        ä½¿ã„æ–¹
                    </h6>
                    <ol class="small mb-0 ps-3">
                        <li class="mb-2">
                            ä¼æ¥­ã‚’æ¤œç´¢ã—ã¦ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã§é¸æŠ
                        </li>
                        <li class="mb-2">
                            <strong>æ¤œç´¢æ¡ä»¶ã‚’å¤‰ãˆã¦åˆ¥ã®ä¼æ¥­ã‚’æ¢ã™</strong><br>
                            <small class="text-muted">â€»é¸æŠçŠ¶æ…‹ã¯è‡ªå‹•çš„ã«ä¿æŒã•ã‚Œã¾ã™</small>
                        </li>
                        <li class="mb-2">
                            å¿…è¦ãªä¼æ¥­ã‚’ã™ã¹ã¦é¸æŠã—ãŸã‚‰ã€<br>
                            ã€Œè¿½åŠ ã€ã¾ãŸã¯ã€Œç½®ãæ›ãˆã€ã‚’ã‚¯ãƒªãƒƒã‚¯
                        </li>
                    </ol>
                    <hr class="my-3">
                    <div class="small">
                        <p class="mb-2"><strong>è¿½åŠ :</strong> æ—¢å­˜ã®ä¼æ¥­ã‚’æ®‹ã—ã¦è¿½åŠ </p>
                        <p class="mb-0"><strong>ç½®ãæ›ãˆ:</strong> æ—¢å­˜ã‚’å‰Šé™¤ã—ã¦ç½®ãæ›ãˆ</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆID
const templateId = {{ template.pk }};
const storageKey = `template_${templateId}_selected_companies`;

// é¸æŠçŠ¶æ…‹ã‚’ç®¡ç†ã™ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
let selectedCompanies = {};

// ========================================
// åˆæœŸåŒ–
// ========================================
document.addEventListener('DOMContentLoaded', function() {
    console.log('ğŸš€ ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿é–‹å§‹');
    
    // é¸æŠçŠ¶æ…‹ã‚’å¾©å…ƒ
    loadSelections();
    
    // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
    setupEventListeners();
    
    // UIã‚’æ›´æ–°ï¼ˆãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®çŠ¶æ…‹ã‚’å¾©å…ƒï¼‰
    updateUI();
    
    console.log('âœ… åˆæœŸåŒ–å®Œäº†ã€‚ç¾åœ¨ã®é¸æŠ:', selectedCompanies);
});

// ========================================
// é¸æŠçŠ¶æ…‹ã®ä¿å­˜ãƒ»èª­ã¿è¾¼ã¿
// ========================================

// sessionStorageã‹ã‚‰é¸æŠçŠ¶æ…‹ã‚’èª­ã¿è¾¼ã¿
function loadSelections() {
    const saved = sessionStorage.getItem(storageKey);
    if (saved) {
        try {
            selectedCompanies = JSON.parse(saved);
            console.log('ğŸ’¾ é¸æŠçŠ¶æ…‹ã‚’å¾©å…ƒ:', selectedCompanies);
        } catch (e) {
            console.error('âŒ é¸æŠçŠ¶æ…‹ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—:', e);
            selectedCompanies = {};
        }
    } else {
        console.log('â„¹ï¸ ä¿å­˜ã•ã‚ŒãŸé¸æŠçŠ¶æ…‹ãŒã‚ã‚Šã¾ã›ã‚“');
        selectedCompanies = {};
    }
}

// sessionStorageã«é¸æŠçŠ¶æ…‹ã‚’ä¿å­˜
function saveSelections() {
    try {
        sessionStorage.setItem(storageKey, JSON.stringify(selectedCompanies));
        console.log('ğŸ’¾ é¸æŠçŠ¶æ…‹ã‚’ä¿å­˜:', selectedCompanies);
    } catch (e) {
        console.error('âŒ é¸æŠçŠ¶æ…‹ã®ä¿å­˜ã«å¤±æ•—:', e);
    }
}

// ========================================
// ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
// ========================================

function setupEventListeners() {
    // å€‹åˆ¥ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®å¤‰æ›´
    document.querySelectorAll('.company-checkbox').forEach(checkbox => {
        checkbox.addEventListener('change', function(e) {
            e.stopPropagation();
            
            const code = this.value;
            const name = this.dataset.companyName;
            
            if (this.checked) {
                selectedCompanies[code] = { code: code, name: name };
                console.log(`âœ“ é¸æŠ: ${name} (${code})`);
            } else {
                delete selectedCompanies[code];
                console.log(`âœ— è§£é™¤: ${name} (${code})`);
            }
            
            saveSelections();
            updateUI();
        });
    });
}

// ========================================
// UIæ›´æ–°
// ========================================

function updateUI() {
    // 1. ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®çŠ¶æ…‹ã‚’æ›´æ–°
    updateCheckboxes();
    
    // 2. é¸æŠæ•°ã‚’æ›´æ–°
    updateCounts();
    
    // 3. é¸æŠæ¸ˆã¿ãƒªã‚¹ãƒˆã‚’æ›´æ–°
    updateSelectedList();
}

// ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®çŠ¶æ…‹ã‚’æ›´æ–°
function updateCheckboxes() {
    document.querySelectorAll('.company-checkbox').forEach(checkbox => {
        const code = checkbox.value;
        const isSelected = selectedCompanies.hasOwnProperty(code);
        
        // ãƒã‚§ãƒƒã‚¯çŠ¶æ…‹ã‚’æ›´æ–°
        checkbox.checked = isSelected;
        
        // è¡Œã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’æ›´æ–°
        const row = checkbox.closest('tr');
        if (row) {
            if (isSelected) {
                row.classList.add('table-active');
                const badge = row.querySelector('.selected-badge');
                if (badge) badge.classList.remove('d-none');
            } else {
                row.classList.remove('table-active');
                const badge = row.querySelector('.selected-badge');
                if (badge) badge.classList.add('d-none');
            }
        }
    });
}

// é¸æŠæ•°ã‚’æ›´æ–°
function updateCounts() {
    const count = Object.keys(selectedCompanies).length;
    const countElements = document.querySelectorAll('#selectionCount, #selectedCount');
    countElements.forEach(el => {
        el.textContent = count;
    });
}

// é¸æŠæ¸ˆã¿ãƒªã‚¹ãƒˆã‚’æ›´æ–°
function updateSelectedList() {
    const container = document.getElementById('selectedCompaniesList');
    const emptyState = document.getElementById('emptyState');
    const count = Object.keys(selectedCompanies).length;
    
    if (count === 0) {
        emptyState.classList.remove('d-none');
        container.querySelectorAll('.selected-company-item').forEach(item => item.remove());
        return;
    }
    
    emptyState.classList.add('d-none');
    
    // æ—¢å­˜ã®ãƒªã‚¹ãƒˆã‚’ã‚¯ãƒªã‚¢
    container.querySelectorAll('.selected-company-item').forEach(item => item.remove());
    
    // é¸æŠæ¸ˆã¿ä¼æ¥­ã‚’è¡¨ç¤ºï¼ˆã‚³ãƒ¼ãƒ‰é †ã«ã‚½ãƒ¼ãƒˆï¼‰
    const sortedCompanies = Object.values(selectedCompanies).sort((a, b) => {
        return a.code.localeCompare(b.code);
    });
    
    sortedCompanies.forEach(company => {
        const item = document.createElement('div');
        item.className = 'selected-company-item d-flex justify-content-between align-items-center p-2 border-bottom';
        item.innerHTML = `
            <div class="flex-grow-1">
                <div class="fw-semibold small">${company.code}</div>
                <small class="text-muted" style="font-size: 0.75rem;">${company.name}</small>
            </div>
            <button type="button" class="btn btn-sm btn-link text-danger p-0" 
                    onclick="removeFromSelection('${company.code}')"
                    title="é¸æŠã‚’è§£é™¤">
                <i class="bi bi-x-circle"></i>
            </button>
        `;
        container.appendChild(item);
    });
}

// ========================================
// æ“ä½œé–¢æ•°
// ========================================

// é¸æŠã‹ã‚‰é™¤å¤–
function removeFromSelection(code) {
    const company = selectedCompanies[code];
    if (!company) return;
    
    console.log(`ğŸ—‘ï¸ é¸æŠè§£é™¤: ${company.name} (${code})`);
    delete selectedCompanies[code];
    saveSelections();
    updateUI();
}

// ã™ã¹ã¦ã®é¸æŠã‚’ã‚¯ãƒªã‚¢
function clearAllSelections() {
    const count = Object.keys(selectedCompanies).length;
    if (count === 0) {
        alert('é¸æŠã•ã‚Œã¦ã„ã‚‹ä¼æ¥­ãŒã‚ã‚Šã¾ã›ã‚“');
        return;
    }
    
    if (confirm(`${count}ç¤¾ã®é¸æŠã‚’ã™ã¹ã¦ã‚¯ãƒªã‚¢ã—ã¾ã™ã‹ï¼Ÿ`)) {
        console.log('ğŸ—‘ï¸ ã™ã¹ã¦ã‚¯ãƒªã‚¢');
        selectedCompanies = {};
        saveSelections();
        updateUI();
    }
}

// ã“ã®ãƒšãƒ¼ã‚¸ã®ä¼æ¥­ã‚’å…¨é¸æŠ
function selectAllOnPage() {
    let addedCount = 0;
    
    document.querySelectorAll('.company-checkbox').forEach(checkbox => {
        const code = checkbox.value;
        const name = checkbox.dataset.companyName;
        
        if (!selectedCompanies[code]) {
            selectedCompanies[code] = { code: code, name: name };
            addedCount++;
        }
    });
    
    if (addedCount > 0) {
        console.log(`âœ“ ã“ã®ãƒšãƒ¼ã‚¸ã®${addedCount}ç¤¾ã‚’é¸æŠ`);
        saveSelections();
        updateUI();
    } else {
        alert('ã“ã®ãƒšãƒ¼ã‚¸ã®ä¼æ¥­ã¯ã™ã¹ã¦é¸æŠæ¸ˆã¿ã§ã™');
    }
}

// ========================================
// æ¤œç´¢ãƒ»ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
// ========================================

// æ¤œç´¢å‰ã«ä¿å­˜
function saveBeforeSearch() {
    console.log('ğŸ” æ¤œç´¢å®Ÿè¡Œå‰ã«ä¿å­˜');
    saveSelections();
}

// ãƒšãƒ¼ã‚¸é·ç§»å‰ã«ä¿å­˜
function saveBeforeNavigate(event) {
    console.log('ğŸ“„ ãƒšãƒ¼ã‚¸é·ç§»å‰ã«ä¿å­˜');
    saveSelections();
    // ãƒªãƒ³ã‚¯é·ç§»ã‚’ç¶™ç¶š
}

// æ¤œç´¢ãƒªã‚»ãƒƒãƒˆ
function resetSearch() {
    saveSelections(); // é¸æŠçŠ¶æ…‹ã¯ä¿æŒ
    window.location.href = '{% url "analysis_template:company_select" template.pk %}';
}

// ========================================
// ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡
// ========================================

function submitForm(action) {
    const count = Object.keys(selectedCompanies).length;
    
    if (count === 0) {
        alert('ä¼æ¥­ã‚’é¸æŠã—ã¦ãã ã•ã„');
        return;
    }
    
    let message = '';
    if (action === 'add') {
        message = `${count}ç¤¾ã‚’è¿½åŠ ã—ã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ`;
    } else {
        message = `æ—¢å­˜ã®ä¼æ¥­ã‚’å‰Šé™¤ã—ã€${count}ç¤¾ã§ç½®ãæ›ãˆã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ`;
    }
    
    if (!confirm(message)) {
        return;
    }
    
    console.log(`ğŸ“¤ é€ä¿¡: ${action}ãƒ¢ãƒ¼ãƒ‰, ${count}ç¤¾`);
    
    // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¨­å®š
    document.getElementById('actionInput').value = action;
    
    // é¸æŠã•ã‚ŒãŸä¼æ¥­ã‚³ãƒ¼ãƒ‰ã‚’éš ã—ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¨ã—ã¦è¿½åŠ 
    const container = document.getElementById('hiddenInputsContainer');
    container.innerHTML = '';
    
    Object.keys(selectedCompanies).forEach(code => {
        const input = document.createElement('input');
        input.type = 'hidden';
        input.name = 'companies';
        input.value = code;
        container.appendChild(input);
    });
    
    // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡å¾Œã«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’ã‚¯ãƒªã‚¢
    sessionStorage.removeItem(storageKey);
    console.log('ğŸ—‘ï¸ sessionStorageã‚’ã‚¯ãƒªã‚¢');
    
    // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡
    document.getElementById('companySelectForm').submit();
}
</script>

<style>
.table th {
    background-color: var(--bg-secondary);
    border-bottom: 2px solid var(--border-primary);
    font-weight: 600;
    color: var(--text-secondary);
    padding: 0.75rem 0.5rem;
}

.table td {
    padding: 0.75rem 0.5rem;
    vertical-align: middle;
}

.table-active {
    background-color: rgba(13, 110, 253, 0.1) !important;
}

.company-row {
    transition: background-color 0.15s ease;
}

.company-row:hover {
    background-color: rgba(0, 0, 0, 0.02);
}

.selected-company-item {
    transition: background-color 0.2s;
}

.selected-company-item:hover {
    background-color: rgba(0, 0, 0, 0.03);
}

.selected-company-item:last-child {
    border-bottom: none !important;
}

#selectionCount {
    min-width: 2.5rem;
    text-align: center;
    padding: 0.35rem 0.65rem;
}

.company-checkbox {
    cursor: pointer;
    width: 1.2rem;
    height: 1.2rem;
}

@media (max-width: 991.98px) {
    .sticky-top {
        position: relative !important;
        top: 0 !important;
    }
}

@media (max-width: 767.98px) {
    .d-flex.gap-2.justify-content-end.flex-wrap {
        flex-direction: column;
    }
    
    .d-flex.gap-2.justify-content-end.flex-wrap .btn {
        width: 100%;
    }
}

/* ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œ */
.dark-mode .table-active,
[data-theme="dark"] .table-active {
    background-color: rgba(59, 130, 246, 0.2) !important;
}

.dark-mode .company-row:hover,
[data-theme="dark"] .company-row:hover {
    background-color: rgba(255, 255, 255, 0.05);
}

.dark-mode .selected-company-item:hover,
[data-theme="dark"] .selected-company-item:hover {
    background-color: rgba(255, 255, 255, 0.05);
}
</style>
{% endblock %}