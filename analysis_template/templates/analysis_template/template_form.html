{% extends 'base.html' %}
{% load static %}

{% block title %}{% if action == 'create' %}レポート作成{% else %}レポート編集{% endif %} - カブログ{% endblock %}

{% block head %}
<link rel="stylesheet" href="{% static 'css/2-layouts/analysis-template.css' %}">
{% endblock %}

{% block content %}
<div class="at-container">
    <!-- ヘッダー -->
    <div class="at-page-header-mobile">
        <h1 class="at-page-title-mobile">
            <i class="bi bi-{% if action == 'create' %}plus-circle{% else %}pencil{% endif %}"></i>
            {% if action == 'create' %}新規レポート作成{% else %}レポート編集{% endif %}
        </h1>
        <p class="at-page-subtitle-mobile">{% if action == 'create' %}企業分析レポートの基本情報を入力{% else %}レポートの基本情報を編集{% endif %}</p>
    </div>

    <!-- ステップインジケーター（作成時のみ） -->
    {% if action == 'create' %}
    <div class="at-steps-mobile">
        <div class="at-step at-step--active">
            <div class="at-step-num">1</div>
            <span>基本情報</span>
        </div>
        <div class="at-step-line"></div>
        <div class="at-step">
            <div class="at-step-num">2</div>
            <span>企業選択</span>
        </div>
        <div class="at-step-line"></div>
        <div class="at-step">
            <div class="at-step-num">3</div>
            <span>指標入力</span>
        </div>
    </div>
    {% endif %}

    <form method="post" novalidate>
        {% csrf_token %}
        
        <div class="at-card">
            <div class="at-form-section">
                <div class="at-form-section-title">
                    <i class="bi bi-info-circle me-1"></i>基本情報
                </div>
                
                <div class="at-form-group">
                    <label for="{{ form.name.id_for_label }}" class="at-form-label">
                        レポート名 <span class="text-danger">*</span>
                    </label>
                    {{ form.name }}
                    {% if form.name.errors %}
                    <div class="text-danger small mt-1">{{ form.name.errors }}</div>
                    {% endif %}
                    <div class="small at-text-muted mt-1">レポートを識別しやすい名前を付けてください</div>
                </div>
                
                <div class="at-form-group">
                    <label for="{{ form.description.id_for_label }}" class="at-form-label">説明（任意）</label>
                    {{ form.description }}
                    {% if form.description.errors %}
                    <div class="text-danger small mt-1">{{ form.description.errors }}</div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- 固定ボトムバー -->
        <div class="at-fixed-bottom-bar">
            <a href="{% if action == 'create' %}{% url 'analysis_template:list' %}{% else %}{% url 'analysis_template:detail' template.pk %}{% endif %}" 
               class="btn btn-secondary at-fixed-btn">
                <i class="bi bi-arrow-left"></i>
                <span>戻る</span>
            </a>
            <button type="submit" class="btn btn-primary at-fixed-btn at-fixed-btn--primary">
                <i class="bi bi-check-circle"></i>
                <span>{% if action == 'create' %}作成{% else %}更新{% endif %}</span>
            </button>
        </div>
    </form>

    {% if action == 'update' %}
    <!-- その他の操作 -->
    <div class="at-card" style="margin-top: 1rem;">
        <h6 class="at-card-title">
            <i class="bi bi-tools me-2"></i>その他の操作
        </h6>
        <div class="at-link-list">
            <a href="{% url 'analysis_template:company_select' template.pk %}" class="at-link-list-item">
                <i class="bi bi-building"></i>
                <span>企業選択</span>
                <i class="bi bi-chevron-right at-link-list-arrow"></i>
            </a>
            <a href="{% url 'analysis_template:metrics_input' template.pk %}" class="at-link-list-item">
                <i class="bi bi-bar-chart"></i>
                <span>指標入力</span>
                <i class="bi bi-chevron-right at-link-list-arrow"></i>
            </a>
            <a href="{% url 'analysis_template:metrics_edit' template.pk %}" class="at-link-list-item">
                <i class="bi bi-pencil-square"></i>
                <span>指標編集</span>
                <i class="bi bi-chevron-right at-link-list-arrow"></i>
            </a>
        </div>
    </div>
    {% endif %}
</div>

<!-- 固定ボトムバー分のスペーサー -->
<div style="height: 80px;"></div>

{% include 'speed_dial.html' with actions=form_actions %}
{% endblock %}
