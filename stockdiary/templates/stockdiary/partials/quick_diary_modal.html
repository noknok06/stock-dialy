{% load static %}

<!-- Enhanced Quick Diary Modal Template -->
<div class="modal fade" id="quickDiaryModal" tabindex="-1" aria-labelledby="quickDiaryModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title text-info" id="quickDiaryModalLabel">
          <i class="bi bi-lightning-fill me-2"></i>クイック日記作成
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="quickDiaryForm" action="{% url 'stockdiary:api_create' %}" method="post" class="needs-validation" novalidate>
          {% csrf_token %}
          <!-- モバイル対応タブナビゲーション -->
          <ul class="nav nav-tabs nav-fill mb-3" id="quickDiaryTabs" role="tablist">
            <li class="nav-item" role="presentation">
              <button class="nav-link active" id="basic-tab" data-bs-toggle="tab" data-bs-target="#basic-info" 
                      type="button" role="tab" aria-controls="basic-info" aria-selected="true">
                <i class="bi bi-info-circle d-none d-sm-inline me-1"></i>基本情報
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="details-tab" data-bs-toggle="tab" data-bs-target="#details-info" 
                      type="button" role="tab" aria-controls="details-info" aria-selected="false">
                <i class="bi bi-card-text d-none d-sm-inline me-1"></i>詳細情報
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="tags-tab" data-bs-toggle="tab" data-bs-target="#tags-info" 
                      type="button" role="tab" aria-controls="tags-info" aria-selected="false">
                <i class="bi bi-tags d-none d-sm-inline me-1"></i>タグ付け
              </button>
            </li>
          </ul>

          <!-- スワイプ可能なタブコンテント -->
          <div class="tab-content" id="quickDiaryTabContent">
            <div class="swipe-hint text-center small text-muted mb-2 d-md-none">
              <i class="bi bi-arrow-left-right me-1"></i> 左右にスワイプでタブを切り替え
            </div>
            
            <!-- 基本情報タブ -->
            <div class="tab-pane fade show active" id="basic-info" role="tabpanel" aria-labelledby="basic-tab">
              <div class="row g-3">
                <!-- 銘柄コード -->
                <div class="col-md-6">
                  <label for="quick_stock_symbol" class="form-label">銘柄コード</label>
                  <div class="input-group">
                    <input type="text" class="form-control" id="quick_stock_symbol" name="stock_symbol" 
                          placeholder="例: 7203" autocomplete="off">
                    <button class="btn btn-outline-primary" type="button" id="quick_fetch_stock_info">
                      <i class="bi bi-search"></i>
                    </button>
                    <div id="symbol-indicator" class="htmx-indicator position-absolute" style="right: 50px; top: 8px;">
                      <div class="spinner-border spinner-border-sm text-primary" role="status">
                        <span class="visually-hidden">検証中...</span>
                      </div>
                    </div>
                  </div>
                  <div id="symbol-feedback" class="form-text"></div>
                </div>
                
                <!-- 銘柄名 -->
                <div class="col-md-6">
                  <label for="quick_stock_name" class="form-label">銘柄名 <span class="text-danger">*</span></label>
                  <label for="quick_stock_name" class="form-label">銘柄名 <span class="text-danger">*</span></label>
                  <input type="text" class="form-control" id="quick_stock_name" name="stock_name" 
                        placeholder="例: トヨタ自動車" required>
                  <div class="invalid-feedback">銘柄名を入力してください</div>
                </div>
                
                <!-- 日付 -->
                <div class="col-md-4">
                  <label for="quick_purchase_date" class="form-label">購入/メモ日 <span class="text-danger">*</span></label>
                  <input type="date" class="form-control" id="quick_purchase_date" name="purchase_date" required>
                </div>
                
                <!-- 購入価格 -->
                <div class="col-md-4">
                  <label for="quick_purchase_price" class="form-label">購入価格</label>
                  <div class="input-group">
                    <input type="number" class="form-control" id="quick_purchase_price" name="purchase_price" 
                          placeholder="円" step="0.01">
                    <button class="btn btn-outline-primary" type="button" id="quick_fetch_price" aria-label="現在価格取得">
                      <i class="bi bi-arrow-repeat"></i>
                    </button>
                  </div>
                  <small class="form-text text-muted">空欄の場合はメモとして扱われます</small>
                </div>
                
                <!-- 購入数量 -->
                <div class="col-md-4">
                  <label for="quick_purchase_quantity" class="form-label">購入数量</label>
                  <input type="number" class="form-control" id="quick_purchase_quantity" name="purchase_quantity" 
                        placeholder="株" step="1">
                  <small class="form-text text-muted">空欄の場合はメモとして扱われます</small>
                </div>
              </div>
              
              <!-- 株価情報カード -->
              <div class="stock-info-card hide mt-3">
                <div class="row">
                  <div class="col-6 col-md-3">
                    <div class="stock-info-row">
                      <div class="stock-info-label">市場：</div>
                      <div class="stock-info-value" id="stock_market"></div>
                    </div>
                  </div>
                  <div class="col-6 col-md-3">
                    <div class="stock-info-row">
                      <div class="stock-info-label">業種：</div>
                      <div class="stock-info-value" id="stock_sector"></div>
                    </div>
                  </div>
                  <div class="col-6 col-md-3">
                    <div class="stock-info-row">
                      <div class="stock-info-label">現在価格：</div>
                      <div class="stock-info-value" id="stock_price"></div>
                    </div>
                  </div>
                  <div class="col-6 col-md-3">
                    <div class="stock-info-row">
                      <div class="stock-info-label">前日比：</div>
                      <div class="stock-info-value" id="stock_change"></div>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- ナビゲーションボタン -->
              <div class="d-flex justify-content-end mt-3">
                <button type="button" class="btn btn-primary" id="to-details-tab">
                  次へ <i class="bi bi-chevron-right"></i>
                </button>
              </div>
            </div>
            
            <!-- 詳細情報タブ -->
            <div class="tab-pane fade" id="details-info" role="tabpanel" aria-labelledby="details-tab">
              <!-- 業種 -->
              <div class="mb-3">
                <label for="quick_sector" class="form-label">業種</label>
                <input type="text" class="form-control" id="quick_sector" name="sector" 
                      placeholder="例: 自動車・輸送機器">
                <small class="form-text text-muted">銘柄検索時に自動入力されます</small>
              </div>
              
              <!-- 購入理由 -->
              <div class="mb-3">
                <label for="quick_reason" class="form-label">購入理由/メモ</label>
                <textarea class="form-control" id="quick_reason" name="reason" rows="5" 
                        placeholder="購入理由や着目点などを記録しましょう"></textarea>
              </div>
              
              <!-- ナビゲーションボタン -->
              <div class="d-flex justify-content-between mt-3">
                <button type="button" class="btn btn-outline-secondary" id="back-to-basic-tab">
                  <i class="bi bi-chevron-left"></i> 戻る
                </button>
                <button type="button" class="btn btn-primary" id="to-tags-tab">
                  次へ <i class="bi bi-chevron-right"></i>
                </button>
              </div>
            </div>
            
            <!-- タグ情報タブ -->
            <div class="tab-pane fade" id="tags-info" role="tabpanel" aria-labelledby="tags-tab">
              <!-- タグセレクト -->
              <div class="mb-3">
                <label for="quick_tags" class="form-label">タグ</label>
                <select class="form-select" id="quick_tags" name="tags" multiple="multiple">
                  <!-- タグオプションはJavaScriptで動的に追加されます -->
                </select>
                <small class="form-text text-muted">複数選択可能です。新しいタグを追加するには、まず<a href="{% url 'tags:list' %}" target="_blank">タグ管理</a>ページで作成してください。</small>
              </div>
              
              <!-- フィードバック表示エリア -->
              <div class="form-status-feedback d-none alert alert-info">
                <span class="feedback-message"></span>
              </div>
              
              <!-- ナビゲーションと送信ボタン -->
              <div class="d-flex justify-content-between mt-3">
                <button type="button" class="btn btn-outline-secondary" id="back-to-details-tab">
                  <i class="bi bi-chevron-left"></i> 戻る
                </button>
                
                <button type="submit" class="btn btn-success px-4" id="quickDiarySubmit">
                  <i class="bi bi-journal-plus"></i> 作成する
                </button>
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
<script src="{% static 'js/quick-diary-tabs.js' %}"></script>
