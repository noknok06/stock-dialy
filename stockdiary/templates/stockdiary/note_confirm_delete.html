{% extends 'base.html' %}
{% load static %}

{% block title %}継続記録の削除確認 | カブログ{% endblock %}

{% block head %}
<link rel="stylesheet" href="{% static 'css/common.css' %}">
<link rel="stylesheet" href="{% static 'css/diary-theme.css' %}">
<link rel="stylesheet" href="{% static 'css/mobile-friendly.css' %}">
{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="row justify-content-center">
    <div class="col-lg-6 col-md-8">
      <!-- ヘッダー -->
      <div class="card border-danger">
        <div class="card-header bg-danger text-white">
          <h4 class="card-title mb-0">
            <i class="bi bi-exclamation-triangle me-2"></i>
            継続記録の削除確認
          </h4>
        </div>
        
        <div class="card-body">
          <!-- 警告メッセージ -->
          <div class="alert alert-danger">
            <i class="bi bi-exclamation-triangle me-2"></i>
            <strong>注意:</strong> この操作は元に戻すことができません。
          </div>
          
          <!-- 削除対象の詳細 -->
          <div class="mb-4">
            <h5 class="text-danger mb-3">削除する継続記録</h5>
            
            <div class="card bg-light">
              <div class="card-body">
                <div class="row">
                  <div class="col-sm-3">
                    <strong>日記:</strong>
                  </div>
                  <div class="col-sm-9">
                    <a href="{% url 'stockdiary:detail' diary_pk %}" class="text-primary">
                      {{ object.diary.stock_name }}
                      {% if object.diary.stock_symbol %}({{ object.diary.stock_symbol }}){% endif %}
                    </a>
                  </div>
                </div>
                
                <div class="row mt-2">
                  <div class="col-sm-3">
                    <strong>記録日:</strong>
                  </div>
                  <div class="col-sm-9">
                    {{ object.date|date:"Y年m月d日" }}
                  </div>
                </div>
                
                <div class="row mt-2">
                  <div class="col-sm-3">
                    <strong>タイプ:</strong>
                  </div>
                  <div class="col-sm-9">
                    <span class="badge 
                      {% if object.note_type == 'analysis' %}bg-primary
                      {% elif object.note_type == 'news' %}bg-info
                      {% elif object.note_type == 'earnings' %}bg-success
                      {% elif object.note_type == 'insight' %}bg-warning
                      {% elif object.note_type == 'risk' %}bg-danger
                      {% else %}bg-secondary{% endif %}">
                      {% if object.note_type == 'analysis' %}分析更新
                      {% elif object.note_type == 'news' %}ニュース
                      {% elif object.note_type == 'earnings' %}決算情報
                      {% elif object.note_type == 'insight' %}新たな気づき
                      {% elif object.note_type == 'risk' %}リスク要因
                      {% else %}その他{% endif %}
                    </span>
                  </div>
                </div>
                
                {% if object.current_price %}
                <div class="row mt-2">
                  <div class="col-sm-3">
                    <strong>記録時価格:</strong>
                  </div>
                  <div class="col-sm-9">
                    {{ object.current_price|floatformat:2 }}円
                  </div>
                </div>
                {% endif %}
                
                <div class="row mt-3">
                  <div class="col-12">
                    <strong>記録内容:</strong>
                    <div class="mt-2 p-3 bg-white border rounded">
                      {{ object.content|linebreaks }}
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- 削除フォーム -->
          <form method="post" class="mb-0">
            {% csrf_token %}
            <div class="d-flex justify-content-between">
              <a href="{% url 'stockdiary:detail' diary_pk %}" class="btn btn-secondary">
                <i class="bi bi-arrow-left me-1"></i>
                キャンセル
              </a>
              
              <button type="submit" class="btn btn-danger">
                <i class="bi bi-trash me-1"></i>
                削除する
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  // 削除フォームの送信時に最終確認
  const deleteForm = document.querySelector('form[method="post"]');
  
  if (deleteForm) {
    deleteForm.addEventListener('submit', function(e) {
      const confirmed = confirm('本当にこの継続記録を削除しますか？\nこの操作は元に戻すことができません。');
      
      if (!confirmed) {
        e.preventDefault();
        return false;
      }
      
      // 送信ボタンを無効化
      const submitBtn = this.querySelector('button[type="submit"]');
      if (submitBtn) {
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<i class="bi bi-hourglass-split me-1"></i>削除中...';
      }
    });
  }
});
</script>
{% endblock %}