{% load static %}
{% load ads_tags %}
<!DOCTYPE html>
<html lang="ja">
<head>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3954701883136363"
     crossorigin="anonymous"></script>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-3QHWL4H3M2"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-3QHWL4H3M2');
  </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>{% block title %}ã‚«ãƒ–ãƒ­ã‚°{% endblock %}</title>
    
    <!-- Google AdSense -->
    {% google_adsense %}
    
    <!-- ãƒ•ã‚¡ãƒ“ã‚³ãƒ³è¨­å®š -->
    <link rel="icon" type="image/svg+xml" href="{% static 'images/icon-modern.svg' %}">
    <link rel="alternate icon" href="{% static 'images/favicon.ico' %}" type="image/x-icon">
    <link rel="apple-touch-icon" href="{% static 'images/apple-touch-icon.png' %}">
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- 1. åŸºç¤ï¼ˆå¤‰æ•°ï¼‰ -->
    <link rel="stylesheet" href="{% static 'css/1-foundations/variables.css' %}">

    <!-- 2. ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ -->
    <link rel="stylesheet" href="{% static 'css/2-layouts/stock_diary_modal.css' %}">

    <!-- 3. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ -->
    <link rel="stylesheet" href="{% static 'css/3-components/badge.css' %}">
    <link rel="stylesheet" href="{% static 'css/3-components/buttons.css' %}">
    <link rel="stylesheet" href="{% static 'css/3-components/card.css' %}">
    <link rel="stylesheet" href="{% static 'css/3-components/header.css' %}">
    <link rel="stylesheet" href="{% static 'css/3-components/modal.css' %}">
    <link rel="stylesheet" href="{% static 'css/3-components/table.css' %}">

    <!-- 4. å…±é€šã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆbase â†’ calendarï¼‰ -->
    <link rel="stylesheet" href="{% static 'css/common-base.css' %}">
    <link rel="stylesheet" href="{% static 'css/common-calendar.css' %}">

    <!-- 5. ãƒšãƒ¼ã‚¸å›ºæœ‰ -->
    <link rel="stylesheet" href="{% static 'css/diary-detail.css' %}">

    <!-- 6. ãƒ†ãƒ¼ãƒï¼ˆæœ€å¾Œã«èª­ã¿è¾¼ã‚€ï¼‰ -->
    <link rel="stylesheet" href="{% static 'css/diary-theme-dark-colors.css' %}">

    <link rel="stylesheet" href="{% static 'css/diary-theme.css' %}">
    <link rel="stylesheet" href="{% static 'css/diary-theme-dark-colors.css' %}">
    <link rel="stylesheet" href="{% static 'css/mobile-friendly.css' %}">
    <link rel="stylesheet" href="{% static 'css/speed-dial.css' %}">
    <link rel="stylesheet" href="{% static 'css/notifications.css' %}">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.1/main.min.css" rel="stylesheet">
    
    <script src="{% static 'pwa-register.js' %}"></script>
    <!-- HTMXã‚’è¿½åŠ  -->
    <script src="https://unpkg.com/htmx.org@1.9.10" integrity="sha384-D1Kt99CQMDuVetoL1lrYwg5t+9QdHe7NLX/SoJYkXDFfX37iInKRy5xLSi8nO7UC" crossorigin="anonymous"></script>

    <!-- å³ä¸ŠãƒŠãƒ“ãƒœã‚¿ãƒ³ã¨ãƒ¢ãƒ¼ãƒ€ãƒ«ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ« -->
    <style>    
      /* å›ºå®šãƒ•ãƒƒã‚¿ãƒ¼ */
      .page-wrapper {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }
      
      .content-wrapper {
        flex: 1 0 auto;
      }
      
      .page-footer-spacer {
        height: 80px; /* ãƒ•ãƒƒã‚¿ãƒ¼ã®é«˜ã•åˆ†ã®ä½™ç™½ */
        width: 100%;
      }  
      
      .nav-btn {
        width: 42px;
        height: 42px;
        border-radius: 50%;
        background-color: rgba(79, 70, 229, 0.5);
        color: white;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        border: none;
      }
      
      .nav-btn:hover, .nav-btn:focus {
        background-color: rgba(79, 70, 229, 0.85);
        transform: scale(1.05);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        color: white;
      }
      
      .nav-btn i {
        font-size: 1.25rem;
      }

      /* ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ */
      .theme-toggle-btn {
        width: 42px;
        height: 42px;
        border-radius: 50%;
        background-color: rgba(79, 70, 229, 0.5);
        color: white;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        border: none;
        cursor: pointer;
      }

      .theme-toggle-btn:hover {
        background-color: rgba(79, 70, 229, 0.85);
        transform: scale(1.05);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      }

      .theme-toggle-btn i {
        font-size: 1.25rem;
      }
      
      /* ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒ¢ãƒ¼ãƒ€ãƒ«ãƒ¡ãƒ‹ãƒ¥ãƒ¼ */
      .fullscreen-menu {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(17, 24, 39, 0.95);
        z-index: 1050;
        overflow-y: auto;
        opacity: 0;
        transition: opacity 0.3s ease;
      }
      
      .fullscreen-menu.active {
        display: block;
        opacity: 1;
      }
      
      .menu-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }
      
      .menu-close {
        background: transparent;
        border: none;
        color: white;
        font-size: 1.5rem;
        cursor: pointer;
        transition: all 0.2s;
      }
      
      .menu-close:hover {
        transform: rotate(90deg);
        color: rgba(255, 255, 255, 0.7);
      }
      
      .menu-title {
        color: white;
        font-size: 1.25rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }
      
      .menu-content {
        padding: 2rem 1rem;
        max-width: 500px;
        margin: 0 auto;
      }
      
      .menu-items {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
      }
      
      .menu-item {
        background-color: rgba(255, 255, 255, 0.05);
        border-radius: 0.75rem;
        padding: 1rem;
        text-decoration: none;
        color: white;
        transition: all 0.2s;
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
      }
      
      .menu-item:hover {
        background-color: rgba(255, 255, 255, 0.1);
        transform: translateY(-3px);
        color: white;
      }
      
      .menu-item-icon {
        font-size: 2rem;
        margin-bottom: 0.75rem;
      }
      
      .menu-item.primary .menu-item-icon {
        color: #4f46e5;
      }
      
      .menu-item.success .menu-item-icon {
        color: #10b981;
      }
      
      .menu-item.info .menu-item-icon {
        color: #3b82f6;
      }
      
      .menu-item.warning .menu-item-icon {
        color: #f59e0b;
      }
      
      .menu-item.danger .menu-item-icon {
        color: #ef4444;
      }
      
      .menu-item-label {
        font-weight: 500;
      }
      
      .menu-divider {
        color: rgba(255, 255, 255, 0.5);
        text-align: center;
        margin: 1.5rem 0;
        font-size: 0.85rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }
      
      .user-section {
        margin-top: 2rem;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        padding-top: 1.5rem;
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      
      .user-avatar {
        width: 64px;
        height: 64px;
        background-color: rgba(255, 255, 255, 0.1);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 1rem;
      }
      
      .user-avatar i {
        font-size: 2rem;
        color: rgba(255, 255, 255, 0.9);
      }
      
      .user-name {
        color: white;
        font-weight: 600;
        margin-bottom: 0.5rem;
      }
      
      .user-actions {
        display: flex;
        gap: 1rem;
        margin-top: 0.5rem;
      }
      
      .user-action {
        padding: 0.5rem 1rem;
        border-radius: 0.5rem;
        text-decoration: none;
        color: white;
        background-color: rgba(255, 255, 255, 0.05);
        transition: all 0.2s;
        font-size: 0.9rem;
      }
      
      .user-action:hover {
        background-color: rgba(255, 255, 255, 0.1);
        color: white;
      }
      
      .logout-action {
        color: #ef4444;
      }
      
      .logout-action:hover {
        background-color: rgba(239, 68, 68, 0.1);
        color: #ef4444;
      }

      /* åºƒå‘Šã‚³ãƒ³ãƒ†ãƒŠã®ã‚¹ã‚¿ã‚¤ãƒ« */
      .ad-container {
        width: 100%;
        max-width: 100%;
        overflow: hidden;
        box-sizing: border-box;
      }

      @media (max-width: 767.98px) {
        .ad-container ins.adsbygoogle {
          width: 100% !important;
          max-width: 100% !important;
        }
      }
            
      /* ãƒ¢ãƒã‚¤ãƒ«ç”¨ã«ã‚¢ã‚¤ãƒ†ãƒ ã®é–“éš”ã¨å†…éƒ¨ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’èª¿æ•´ */
      @media (max-width: 480px) {
        .menu-content {
          padding: 1.5rem 0.75rem;
        }
        
        .menu-items {
          gap: 0.75rem; /* é–“éš”ã‚’å°‘ã—ç‹­ãã™ã‚‹ */
        }
        
        .menu-item {
          padding: 0.75rem; /* ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’å°‘ã—å°ã•ãã™ã‚‹ */
        }
        
        .menu-item-icon {
          font-size: 1.75rem; /* ã‚¢ã‚¤ã‚³ãƒ³ã‚µã‚¤ã‚ºã‚’å°‘ã—å°ã•ãã™ã‚‹ */
          margin-bottom: 0.5rem;
        }
        
        .menu-item-label {
          font-size: 0.9rem; /* ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºã‚’å°‘ã—å°ã•ãã™ã‚‹ */
        }
        
        /* ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ä½™ç™½èª¿æ•´ */
        .user-section {
          margin-top: 1.5rem;
          padding-top: 1.25rem;
        }
      }

      .theme-toggle-section {
        width: 100%;
        max-width: 280px;
        margin: 1.5rem 0;
      }

      .theme-toggle-menu-btn {
        width: 100%;
        background-color: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 0.75rem;
        padding: 1rem 1.25rem;
        color: white;
        display: flex;
        align-items: center;
        gap: 0.75rem;
        transition: all 0.2s;
        cursor: pointer;
        font-size: 1rem;
      }

      .theme-toggle-menu-btn:hover {
        background-color: rgba(255, 255, 255, 0.1);
      }

      .theme-toggle-menu-btn span {
        flex: 1;
        text-align: left;
      }

      .theme-toggle-menu-btn .toggle-icon {
        font-size: 1.5rem;
        transition: all 0.3s;
      }

      .theme-toggle-menu-btn.active .toggle-icon {
        color: #10b981;
      }

      .theme-toggle-menu-btn.active .toggle-icon::before {
        content: "\f624"; /* bi-toggle-on */
      }
      .ad-label {
        position: absolute;
        top: 2px;
        right: 10px;
        font-size: 10px;
        color: #adb5bd;
        text-transform: uppercase;
      }
      
      .ad-banner {
        min-height: 90px;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      
      .upgrade-prompt {
        text-align: center;
        margin-top: 8px;
        font-size: 12px;
      }
      
      /* å„é…ç½®ä½ç½®ã”ã¨ã®ã‚¹ã‚¿ã‚¤ãƒ« */
      .ad-header {
        margin-bottom: 1rem;
      }
      
      .ad-sidebar {
        margin-bottom: 1.5rem;
      }
      
      .ad-content_top {
        margin-bottom: 2rem;
      }
      
      .ad-content_bottom {
        margin-top: 2rem;
        margin-bottom: 1rem;
      }
      
      .ad-footer {
        margin-top: 1.5rem;
      }

      /* ãƒ•ãƒƒã‚¿ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ« */
      .app-footer {
        background-color: #f8f9fa;
        border-top: 1px solid rgba(0, 0, 0, 0.05);
        padding: 3rem 0 2rem;
        margin-top: 2rem;
        position: relative;
      }

      /* ã‚¹ãƒ”ãƒ¼ãƒ‰ãƒ€ã‚¤ãƒ¤ãƒ«ãªã©ã®å›ºå®šè¦ç´ ã®ãŸã‚ã«ä¸‹éƒ¨ã«ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’è¿½åŠ  */
      @media (max-width: 767.98px) {
        .app-footer {
          padding: 2rem 0 5rem;
        }
      }

      /* åŒºåˆ‡ã‚Šç·š */
      .footer-divider {
        height: 1px;
        background-color: rgba(0, 0, 0, 0.06);
      }

      /* ã‚³ãƒ”ãƒ¼ãƒ©ã‚¤ãƒˆ */
      .footer-copyright {
        margin-top: 1rem;
      }

      /* ãƒ•ãƒƒã‚¿ãƒ¼ãƒ–ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚° */
      .footer-branding {
        margin-bottom: 1.5rem;
      }

      /* ãƒ•ãƒƒã‚¿ãƒ¼ãƒ­ã‚´ */
      .footer-logo {
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--text-primary);
        text-decoration: none;
        display: inline-flex;
        align-items: center;
      }

      .footer-logo:hover {
        color: var(--primary-color);
        text-decoration: none;
      }

      /* ãƒ•ãƒƒã‚¿ãƒ¼èª¬æ˜æ–‡ */
      .footer-description {
        margin-top: 0.75rem;
        font-size: 0.9rem;
        max-width: 600px;
      }

      @media (max-width: 767.98px) {
        .footer-description {
          font-size: 0.85rem;
          padding: 0 0.5rem;
        }
      }

      /* SNSãƒªãƒ³ã‚¯ */
      .social-link {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 36px;
        height: 36px;
        border-radius: 50%;
        background-color: rgba(79, 70, 229, 0.1);
        color: var(--primary-color);
        transition: all 0.2s ease;
      }

      .social-link:hover {
        background-color: var(--primary-color);
        color: white;
        transform: translateY(-2px);
      }

      /* ãƒ•ãƒƒã‚¿ãƒ¼ã‚½ãƒ¼ã‚·ãƒ£ãƒ«ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
      .footer-social {
        margin-top: 1rem;
      }
      /* ç”»åƒé–¢é€£ã®ã‚¹ã‚¿ã‚¤ãƒ« */
      .diary-attached-image,
      .note-attached-image,
      .diary-main-image {
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }

      .diary-attached-image:hover,
      .note-attached-image:hover,
      .diary-main-image:hover {
        transform: scale(1.02);
        box-shadow: 0 6px 12px rgba(0,0,0,0.15);
      }

      .image-upload-area {
        border: 2px dashed #dee2e6;
        border-radius: 8px;
        padding: 2rem;
        text-align: center;
        transition: all 0.3s ease;
        cursor: pointer;
      }

      .image-upload-area:hover {
        border-color: var(--primary-color, #5a7ec5);
        background-color: rgba(90, 126, 197, 0.05);
      }

      .image-upload-area.dragover {
        border-color: var(--primary-color, #5a7ec5);
        background-color: rgba(90, 126, 197, 0.1);
      }

      .note-image img,
      .diary-image img {
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }

      /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
      @media (max-width: 768px) {
        .modal-lg {
          max-width: 95%;
        }
        
        #modalImage {
          max-height: 60vh;
        }
        
        .diary-main-image {
          max-height: 200px !important;
        }
        
        .diary-attached-image,
        .note-attached-image {
          max-height: 120px !important;
        }
      }

      /* ========== Dark Mode Support ========== */

      /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
      .dark-mode .pc-only-header .navbar,
      [data-theme="dark"] .pc-only-header .navbar {
        background-color: var(--dm-card) !important;
        border-bottom-color: var(--dm-border);
      }

      .dark-mode .navbar-brand,
      [data-theme="dark"] .navbar-brand {
        color: var(--dm-foreground) !important;
      }

      .dark-mode .nav-link,
      [data-theme="dark"] .nav-link {
        color: var(--dm-muted-foreground) !important;
      }

      .dark-mode .nav-link:hover,
      [data-theme="dark"] .nav-link:hover {
        color: var(--dm-primary) !important;
      }

      .dark-mode .dropdown-menu,
      [data-theme="dark"] .dropdown-menu {
        background-color: var(--dm-card);
        border-color: var(--dm-border);
      }

      .dark-mode .dropdown-item,
      [data-theme="dark"] .dropdown-item {
        color: var(--dm-foreground);
      }

      .dark-mode .dropdown-item:hover,
      [data-theme="dark"] .dropdown-item:hover {
        background-color: rgba(71, 85, 105, 0.3);
        color: var(--dm-primary);
      }

      .dark-mode .dropdown-divider,
      [data-theme="dark"] .dropdown-divider {
        border-top-color: var(--dm-border);
      }

      .dark-mode .avatar-circle,
      [data-theme="dark"] .avatar-circle {
        background-color: rgba(59, 130, 246, 0.2) !important;
      }

      .dark-mode .avatar-circle i,
      [data-theme="dark"] .avatar-circle i {
        color: var(--dm-primary) !important;
      }

      /* ãƒ•ãƒƒã‚¿ãƒ¼ */
      .dark-mode .app-footer,
      [data-theme="dark"] .app-footer {
        background-color: var(--dm-card);
        border-top-color: var(--dm-border);
      }

      .dark-mode .footer-logo,
      [data-theme="dark"] .footer-logo {
        color: var(--dm-foreground);
      }

      .dark-mode .footer-logo:hover,
      [data-theme="dark"] .footer-logo:hover {
        color: var(--dm-primary);
      }

      .dark-mode .footer-description,
      .dark-mode .text-muted,
      [data-theme="dark"] .footer-description,
      [data-theme="dark"] .text-muted {
        color: var(--dm-muted-foreground) !important;
      }

      .dark-mode .footer-divider,
      [data-theme="dark"] .footer-divider {
        background-color: var(--dm-border);
      }

      .dark-mode .footer-links a,
      [data-theme="dark"] .footer-links a {
        color: var(--dm-muted-foreground) !important;
      }

      .dark-mode .footer-links a:hover,
      [data-theme="dark"] .footer-links a:hover {
        color: var(--dm-primary) !important;
      }

      .dark-mode .social-link,
      [data-theme="dark"] .social-link {
        background-color: rgba(59, 130, 246, 0.2);
        color: var(--dm-primary);
      }

      .dark-mode .social-link:hover,
      [data-theme="dark"] .social-link:hover {
        background-color: var(--dm-primary);
        color: white;
      }

      /* ã‚³ãƒ³ãƒ†ãƒŠ */
      .dark-mode .container,
      [data-theme="dark"] .container {
        color: var(--dm-foreground);
      }

      /* ã‚¢ãƒ©ãƒ¼ãƒˆ */
      .dark-mode .alert,
      [data-theme="dark"] .alert {
        background-color: rgba(71, 85, 105, 0.3);
        border-color: var(--dm-border);
        color: var(--dm-foreground);
      }

      .dark-mode .alert-info,
      [data-theme="dark"] .alert-info {
        background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(37, 99, 235, 0.1));
        border-color: rgba(59, 130, 246, 0.3);
        color: var(--dm-info);
      }

      .dark-mode .alert-success,
      [data-theme="dark"] .alert-success {
        background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(5, 150, 105, 0.1));
        border-color: rgba(16, 185, 129, 0.3);
        color: var(--dm-success);
      }

      .dark-mode .alert-warning,
      [data-theme="dark"] .alert-warning {
        background: linear-gradient(135deg, rgba(245, 158, 11, 0.2), rgba(217, 119, 6, 0.1));
        border-color: rgba(245, 158, 11, 0.3);
        color: var(--dm-accent);
      }

      .dark-mode .alert-danger,
      [data-theme="dark"] .alert-danger {
        background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(220, 38, 38, 0.1));
        border-color: rgba(239, 68, 68, 0.3);
        color: var(--dm-destructive);
      }

      /* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ï¼ˆæµ®å‹•ï¼‰ */
      .dark-mode .nav-btn,
      [data-theme="dark"] .nav-btn {
        background-color: rgba(59, 130, 246, 0.6);
      }

      .dark-mode .nav-btn:hover,
      [data-theme="dark"] .nav-btn:hover {
        background-color: rgba(59, 130, 246, 0.9);
      }

      .dark-mode .theme-toggle-btn,
      [data-theme="dark"] .theme-toggle-btn {
        background-color: rgba(59, 130, 246, 0.6);
      }

      .dark-mode .theme-toggle-btn:hover,
      [data-theme="dark"] .theme-toggle-btn:hover {
        background-color: rgba(59, 130, 246, 0.9);
      }

      /* ç”»åƒé–¢é€£ */
      .dark-mode .image-upload-area,
      [data-theme="dark"] .image-upload-area {
        border-color: var(--dm-border);
        background-color: rgba(71, 85, 105, 0.2);
      }

      .dark-mode .image-upload-area:hover,
      [data-theme="dark"] .image-upload-area:hover {
        border-color: var(--dm-primary);
        background-color: rgba(59, 130, 246, 0.1);
      }

      /* é€šçŸ¥ãƒ™ãƒ« */
      .dark-mode .notification-bell-container .btn-link,
      [data-theme="dark"] .notification-bell-container .btn-link {
        color: var(--dm-foreground) !important;
      }

      .dark-mode .notification-bell-container .dropdown-menu,
      [data-theme="dark"] .notification-bell-container .dropdown-menu {
        background-color: var(--dm-card);
        border-color: var(--dm-border);
      }

      .dark-mode .notification-bell-container h6,
      [data-theme="dark"] .notification-bell-container h6 {
        color: var(--dm-foreground);
      }

      /* PWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ */
      .dark-mode #pwa-install-container,
      [data-theme="dark"] #pwa-install-container {
        background-color: var(--dm-primary) !important;
      }
    </style>
    
    <!-- PWAå¯¾å¿œ -->
    <link rel="manifest" href="{% static 'manifest.json' %}">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="ã‚«ãƒ–ãƒ­ã‚°">
    <meta name="msapplication-TileColor" content="#5a7ec5">
    <meta name="theme-color" content="#5a7ec5">
    
    <!-- iOSç”¨ã‚¢ã‚¤ã‚³ãƒ³ -->
    <link rel="apple-touch-icon" sizes="180x180" href="{% static 'images/apple-touch-icon.png' %}">
    
    <!-- PWAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ -->
    <div id="pwa-install-container" style="display: none;" class="position-fixed top-0 start-0 end-0 bg-primary text-white p-2 z-index-1060">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <i class="bi bi-phone me-2"></i>
                    <span>ğŸ“± ã‚«ãƒ–ãƒ­ã‚°ã‚’ãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã—ã¾ã›ã‚“ã‹ï¼Ÿ</span>
                </div>
                <div>
                    <button id="pwa-install-btn" class="btn btn-light btn-sm me-2">
                        <i class="bi bi-download me-1"></i>è¿½åŠ 
                    </button>
                    <button id="pwa-install-dismiss" class="btn btn-outline-light btn-sm" onclick="document.getElementById('pwa-install-container').style.display='none'">
                        å¾Œã§
                    </button>
                </div>
            </div>
        </div>
    </div>
    {% block head %}{% endblock %}
</head>
<body>
  <div class="page-wrapper">
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header class="pc-only-header">
        <nav class="navbar navbar-expand bg-light border-bottom shadow-sm">
            <div class="container">
                <!-- ãƒ­ã‚´ãƒ»ã‚µã‚¤ãƒˆå - å¸¸ã«è¡¨ç¤º -->
                  <a class="navbar-brand d-flex align-items-center" href="{% url 'landing_page' %}">
                    <img src="{% static 'images/icon-modern.svg' %}" width="30" height="30" class="me-2" alt="ã‚«ãƒ–ãƒ­ã‚°">
                    <span class="fw-bold">ã‚«ãƒ–ãƒ­ã‚°</span>
                </a>
              
                <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒªãƒ³ã‚¯ -->
                <div class="navbar-nav-container">
                    <ul class="navbar-nav me-auto">
                      {% if user.is_authenticated %}
                      <li class="nav-item">
                          <a class="nav-link" href="{% url 'stockdiary:home' %}">
                              <i class="bi bi-journal-text"></i> æ—¥è¨˜ä¸€è¦§
                          </a>
                      </li>
                      <li class="nav-item">
                          <a class="nav-link" href="{% url 'stockdiary:create' %}">
                              <i class="bi bi-plus-circle"></i> æ–°è¦ä½œæˆ
                          </a>
                      </li>
                      <li class="nav-item">
                          <a class="nav-link" href="{% url 'analysis_template:list' %}">
                              <i class="bi bi-clipboard-data"></i> åˆ†æãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
                          </a>
                      </li>
                      {% endif %}
                  </ul>
                  
                    <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
                    {% if user.is_authenticated %}
                    <div class="d-flex align-items-center gap-2">
                        <!-- ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ -->
                        <button class="theme-toggle-btn" id="theme-toggle" aria-label="ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ" title="ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ">
                            <i class="bi bi-moon-stars"></i>
                        </button>

                        <div class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                <div class="avatar-circle bg-primary bg-opacity-10 me-2">
                                    <i class="bi bi-person text-primary"></i>
                                </div>
                                <span>{{ user.username }}</span>
                                {% if is_pro %}
                                <span class="badge bg-primary ms-1">PRO</span>
                                {% elif is_premium %}
                                <span class="badge bg-success ms-1">BASIC</span>
                                {% endif %}
                            </a>
                            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                                <li><a class="dropdown-item" href="{% url 'users:profile' %}"><i class="bi bi-person me-2"></i>ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</a></li>
                                <li><a class="dropdown-item" href="{% url 'ads:ad_preferences' %}"><i class="bi bi-gear me-2"></i>åºƒå‘Šè¨­å®š</a></li>
                                <li><a class="dropdown-item" href="{% url 'ads:privacy_policy' %}"><i class="bi bi-shield-lock me-2"></i>ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼</a></li>
                                <li><a class="dropdown-item" href="{% url 'ads:terms' %}"><i class="bi bi-file-text me-2"></i>åˆ©ç”¨è¦ç´„ãƒ»å…è²¬äº‹é …</a></li>
                                <li><a class="dropdown-item" href="{% url 'ads:faq' %}"><i class="bi bi-question-circle me-2"></i>ã‚ˆãã‚ã‚‹è³ªå•</a></li>
                                <li><a class="dropdown-item" href="{% url 'ads:guide' %}"><i class="bi bi-book me-2"></i>ã”åˆ©ç”¨ã‚¬ã‚¤ãƒ‰</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item text-danger" href="{% url 'users:logout' %}"><i class="bi bi-box-arrow-right me-2"></i>ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a></li>
                            </ul>
                        </div>
                    </div>
                    {% else %}
                    <div class="d-flex align-items-center gap-2">
                        <!-- ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ -->
                        <button class="theme-toggle-btn" id="theme-toggle-guest" aria-label="ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ" title="ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ">
                            <i class="bi bi-moon-stars"></i>
                        </button>
                        <a href="{% url 'users:login' %}" class="btn btn-outline-primary me-2">ãƒ­ã‚°ã‚¤ãƒ³</a>
                        <a href="{% url 'users:signup' %}" class="btn btn-primary">æ–°è¦ç™»éŒ²</a>
                    </div>
                    {% endif %}
                </div>
            </div>
        </nav>
    </header>

    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ©ãƒƒãƒ‘ãƒ¼ -->
    <div class="content-wrapper">
      <!-- ãƒ˜ãƒƒãƒ€ãƒ¼åºƒå‘Š -->
      {% if show_ads %}
          {% show_placement_ad "header" %}
      {% endif %}

      <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
      <div class="container mt-4">
          <!-- ã‚·ã‚¹ãƒ†ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
          {% if messages %}
              {% for message in messages %}
                  <div class="alert alert-{{ message.tags }} alert-dismissible fade show mb-4">
                      {{ message }}
                      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                  </div>
              {% endfor %}
          {% endif %}

          <!-- å®Ÿéš›ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
          {% block content %}{% endblock %}

          <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ä¸‹éƒ¨ã®åºƒå‘Š -->
          {% if show_ads %}
              {% show_placement_ad "content_bottom" %}
          {% endif %}
      </div>
      
    </div>
  </div>
<!-- ãƒ•ãƒƒã‚¿ãƒ¼åºƒå‘Š -->
{% if show_ads %}
    {% show_placement_ad "footer" %}
{% endif %}
<!-- ãƒ•ãƒƒã‚¿ãƒ¼ã«ãŠå•ã„åˆã‚ã›ãƒªãƒ³ã‚¯ã‚’è¿½åŠ  -->
<footer class="app-footer">
  <div class="container">
    <!-- ãƒ­ã‚´ã¨èª¬æ˜éƒ¨åˆ† -->
    <div class="row justify-content-center">
      <div class="col-lg-8 col-md-10 text-center">
        <div class="footer-branding mb-4">
          <a href="{% url 'landing_page' %}" class="footer-logo d-inline-flex align-items-center">
            <img src="{% static 'images/icon-modern.svg' %}" width="30" height="30" class="me-2" alt="ã‚«ãƒ–ãƒ­ã‚°">
            <span class="fw-bold">ã‚«ãƒ–ãƒ­ã‚°</span>
          </a>
          <p class="text-muted mt-3 mb-0 footer-description mx-auto">
æŠ•è³‡è¨˜éŒ²ã¨åˆ†æã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã€‚æ—¥ã€…ã®æŠ•è³‡åˆ¤æ–­ã‚’è¨˜éŒ²ã—ã€ã‚ˆã‚Šè‰¯ã„æŠ•è³‡å®¶ã«ãªã‚‹ãŸã‚ã®ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚
          </p>
        </div>
        
        <!-- ãƒªãƒ³ã‚¯ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="footer-links d-flex justify-content-center flex-wrap gap-3 mb-4">
          <a href="{% url 'contact:contact' %}" class="text-muted text-decoration-none">
            <i class="bi bi-envelope me-1"></i>ãŠå•ã„åˆã‚ã›
          </a>
          <a href="{% url 'ads:privacy_policy' %}" class="text-muted text-decoration-none">
            <i class="bi bi-shield-lock me-1"></i>ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼
          </a>
          <a href="{% url 'ads:terms' %}" class="text-muted text-decoration-none">
            <i class="bi bi-file-text me-1"></i>åˆ©ç”¨è¦ç´„ãƒ»å…è²¬äº‹é …
          </a>
          <a href="{% url 'ads:faq' %}" class="text-muted text-decoration-none">
            <i class="bi bi-question-circle me-1"></i>ã‚ˆãã‚ã‚‹è³ªå•
          </a>
          <a href="{% url 'ads:guide' %}" class="text-muted text-decoration-none">
            <i class="bi bi-book me-1"></i>ã”åˆ©ç”¨ã‚¬ã‚¤ãƒ‰
          </a>
        </div>
        
        <!-- SNSãƒªãƒ³ã‚¯ -->
        <div class="footer-social d-flex gap-3 justify-content-center mt-4">
          <a href="https://x.com/kabulog_net?s=21" class="social-link" aria-label="Twitter">
            <i class="bi bi-twitter-x"></i>
          </a>
        </div>
      </div>
    </div>
    
    <!-- åŒºåˆ‡ã‚Šç·š -->
    <div class="footer-divider my-4"></div>
    
    <!-- ã‚³ãƒ”ãƒ¼ãƒ©ã‚¤ãƒˆ -->
    <div class="footer-copyright text-center">
      <p class="text-muted small mb-0">Â© {% now "Y" %} ã‚«ãƒ–ãƒ­ã‚°. All rights reserved.</p>
    </div>
  </div>
</footer>
  <!-- å³ä¸Šã«é…ç½®ã™ã‚‹åŠé€æ˜ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ -->
  {% if user.is_authenticated %}
  <div class="floating-nav-button">
      <button class="nav-btn" id="openMenuButton" type="button" aria-label="ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‹ã">
          <i class="bi bi-grid"></i>
      </button>
  </div>
  
  <!-- ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒ¢ãƒ¼ãƒ€ãƒ«ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
  <div class="fullscreen-menu" id="fullscreenMenu">
    <div class="menu-header">
        <div class="menu-title">
            <img src="{% static 'images/icon-modern.svg' %}" width="24" height="24" class="me-2" alt="ã‚«ãƒ–ãƒ­ã‚°">
            ã‚«ãƒ–ãƒ­ã‚°ãƒ¡ãƒ‹ãƒ¥ãƒ¼
        </div>
        <button class="menu-close" id="closeMenuButton" type="button" aria-label="ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‰ã˜ã‚‹">
            <i class="bi bi-x-lg"></i>
        </button>
    </div>
    
    <div class="menu-content">
        <div class="menu-items">
            <!-- ä¸»è¦æ©Ÿèƒ½ -->
            <a href="{% url 'stockdiary:home' %}" class="menu-item primary">
                <div class="menu-item-icon">
                    <i class="bi bi-journal-text"></i>
                </div>
                <div class="menu-item-label">æ—¥è¨˜ä¸€è¦§</div>
            </a>
            
            <a href="{% url 'stockdiary:dashboard' %}" class="menu-item primary">
                <div class="menu-item-icon">
                    <i class="bi bi-building"></i>
                </div>
                <div class="menu-item-label">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</div>
            </a>
            
            <a href="{% url 'stockdiary:create' %}" class="menu-item primary">
                <div class="menu-item-icon">
                    <i class="bi bi-plus-circle"></i>
                </div>
                <div class="menu-item-label">æ–°è¦ä½œæˆ</div>
            </a>
            
            <a href="{% url 'stockdiary:notification_list' %}" class="menu-item primary">
                <div class="menu-item-icon">
                    <i class="bi bi-bell"></i>
                </div>
                <div class="menu-item-label">é€šçŸ¥ç®¡ç†</div>
            </a>
        </div>
        
        <div class="menu-divider">ç®¡ç†æ©Ÿèƒ½</div>
        
        <div class="menu-items">
          <a href="{% url 'tags:list' %}" class="menu-item success">
              <div class="menu-item-icon">
                  <i class="bi bi-tags"></i>
              </div>
              <div class="menu-item-label">ã‚¿ã‚°ç®¡ç†</div>
          </a>
          
          <a href="{% url 'analysis_template:list' %}" class="menu-item success">
              <div class="menu-item-icon">
                  <i class="bi bi-clipboard-data"></i>
              </div>
              <div class="menu-item-label">åˆ†æãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ</div>
          </a>
          <a href="{% url 'stockdiary:trade_upload' %}" class="menu-item success">
            <div class="menu-item-icon">
                <i class="bi bi-cloud-upload"></i>
            </div>
            <div class="menu-item-label">å–å¼•å±¥æ­´ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</div>
          </a>    
          <a href="{% url 'financial_reports:report_list' %}" class="menu-item success">
            <div class="menu-item-icon">
                <i class="bi bi-flag"></i>
            </div>
            <div class="menu-item-label">æ±ºç®—ãƒ¬ãƒãƒ¼ãƒˆ</div>
          </a>        
        </div>


        <div class="menu-divider">APP</div>

        <div class="menu-items">
            <a href="{% url 'copomo:index' %}" class="menu-item danger">
                <div class="menu-item-icon">
                    <i class="bi bi-emoji-smile-fill"></i>
                </div>
                <div class="menu-item-label">CopoMo</div>
            </a>
        </div>
        <div class="menu-divider">ãƒ˜ãƒ«ãƒ—ãƒ»ã‚µãƒãƒ¼ãƒˆ</div>
        
        <div class="menu-items">
            <a href="{% url 'ads:guide' %}" class="menu-item warning">
                <div class="menu-item-icon">
                    <i class="bi bi-book"></i>
                </div>
                <div class="menu-item-label">ã”åˆ©ç”¨ã‚¬ã‚¤ãƒ‰</div>
            </a>

            <a href="{% url 'ads:faq' %}" class="menu-item warning">
                <div class="menu-item-icon">
                    <i class="bi bi-question-circle"></i>
                </div>
                <div class="menu-item-label">ã‚ˆãã‚ã‚‹è³ªå•</div>
            </a>
            
            <a href="{% url 'ads:terms' %}" class="menu-item warning">
                <div class="menu-item-icon">
                    <i class="bi bi-file-text"></i>
                </div>
                <div class="menu-item-label">åˆ©ç”¨è¦ç´„</div>
            </a>
            
            <a href="{% url 'ads:privacy_policy' %}" class="menu-item warning">
                <div class="menu-item-icon">
                    <i class="bi bi-shield-lock"></i>
                </div>
                <div class="menu-item-label">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼</div>
            </a>
            
            <a href="{% url 'contact:contact' %}" class="menu-item warning">
                <div class="menu-item-icon">
                    <i class="bi bi-envelope"></i>
                </div>
                <div class="menu-item-label">ãŠå•ã„åˆã‚ã›</div>
            </a>
        </div>
        
        <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="user-section">
            <div class="user-avatar">
                <i class="bi bi-person"></i>
            </div>
            <div class="user-name">{{ user.username }}</div>
            
            <!-- ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ -->
            <div class="theme-toggle-section">
                <button class="theme-toggle-menu-btn" id="theme-toggle-menu" aria-label="ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ">
                    <i class="bi bi-moon-stars"></i>
                    <span>ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰</span>
                    <i class="bi bi-toggle-off toggle-icon"></i>
                </button>
            </div>
            <div class="user-actions">
                <a href="{% url 'users:profile' %}" class="user-action">
                    <i class="bi bi-person me-1"></i> ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«
                </a>
                <a href="{% url 'users:logout' %}" class="user-action logout-action">
                    <i class="bi bi-box-arrow-right me-1"></i> ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
                </a>
            </div>
        </div>
    </div>
  </div>
  {% endif %}

  <!-- ç”»åƒãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div class="modal fade" id="imageModal" tabindex="-1" aria-labelledby="imageModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="imageModalLabel">ç”»åƒè¡¨ç¤º</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body text-center p-0">
          <img id="modalImage" class="img-fluid" alt="ç”»åƒ" style="max-width: 100%; max-height: 70vh; object-fit: contain;">
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">é–‰ã˜ã‚‹</button>
          <a id="modalImageDownload" class="btn btn-primary" download>
            <i class="bi bi-download"></i> ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
          </a>
        </div>
      </div>
    </div>
  </div>

 <!-- Bootstrap JavaScript Bundle with Popper -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  {% block vendor_js %}{% endblock %}
  
  <!-- ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
  <script>
    // ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½
    (function() {
      const THEME_KEY = 'theme-preference';
      
      // åˆæœŸãƒ†ãƒ¼ãƒã®è¨­å®š
      function getInitialTheme() {
        const savedTheme = localStorage.getItem(THEME_KEY);
        if (savedTheme) {
          return savedTheme;
        }
        // ã‚·ã‚¹ãƒ†ãƒ è¨­å®šã‚’ç¢ºèª
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
          return 'dark';
        }
        return 'light';
      }
      
      // ãƒ†ãƒ¼ãƒã‚’é©ç”¨
      function applyTheme(theme) {
        if (theme === 'dark') {
          document.body.classList.add('dark-mode');
          document.documentElement.setAttribute('data-theme', 'dark');
        } else {
          document.body.classList.remove('dark-mode');
          document.documentElement.removeAttribute('data-theme');
        }
        localStorage.setItem(THEME_KEY, theme);
        updateToggleButtons(theme);
      }
      
      // ã™ã¹ã¦ã®ãƒˆã‚°ãƒ«ãƒœã‚¿ãƒ³ã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’æ›´æ–°
      function updateToggleButtons(theme) {
        // ãƒ˜ãƒƒãƒ€ãƒ¼ã®ãƒˆã‚°ãƒ«ãƒœã‚¿ãƒ³ï¼ˆPCç”¨ï¼‰
        const headerButtons = document.querySelectorAll('#theme-toggle, #theme-toggle-guest');
        headerButtons.forEach(button => {
          if (button) {
            const icon = button.querySelector('i');
            if (icon) {
              if (theme === 'dark') {
                icon.className = 'bi bi-sun-fill';
              } else {
                icon.className = 'bi bi-moon-stars';
              }
            }
          }
        });
        
        // ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®ãƒˆã‚°ãƒ«ãƒœã‚¿ãƒ³ï¼ˆã‚¹ãƒãƒ›ç”¨ï¼‰
        const menuButton = document.getElementById('theme-toggle-menu');
        if (menuButton) {
          const icon = menuButton.querySelector('i:first-child');
          const toggleIcon = menuButton.querySelector('.toggle-icon');
          
          if (theme === 'dark') {
            // ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆ
            if (icon) {
              icon.className = 'bi bi-sun-fill';
            }
            menuButton.classList.add('active');
            // ãƒˆã‚°ãƒ«ã‚¢ã‚¤ã‚³ãƒ³ã¯è‡ªå‹•çš„ã«å¤‰ã‚ã‚‹ï¼ˆCSSã§åˆ¶å¾¡ï¼‰
          } else {
            // ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰ã®å ´åˆ
            if (icon) {
              icon.className = 'bi bi-moon-stars';
            }
            menuButton.classList.remove('active');
          }
        }
      }
      
      // ãƒ†ãƒ¼ãƒã‚’åˆ‡ã‚Šæ›¿ãˆ
      function toggleTheme() {
        const currentTheme = localStorage.getItem(THEME_KEY) || 'light';
        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
        applyTheme(newTheme);
      }
      
      // åˆæœŸåŒ– - ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ãƒ†ãƒ¼ãƒã‚’é©ç”¨
      const initialTheme = getInitialTheme();
      applyTheme(initialTheme);
      
      // DOMContentLoadedå¾Œã«ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
      document.addEventListener('DOMContentLoaded', function() {
        // ãƒ˜ãƒƒãƒ€ãƒ¼ã®ãƒˆã‚°ãƒ«ãƒœã‚¿ãƒ³
        const headerToggleButtons = document.querySelectorAll('#theme-toggle, #theme-toggle-guest');
        headerToggleButtons.forEach(button => {
          if (button) {
            button.addEventListener('click', toggleTheme);
          }
        });
        
        // ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®ãƒˆã‚°ãƒ«ãƒœã‚¿ãƒ³
        const menuToggleButton = document.getElementById('theme-toggle-menu');
        if (menuToggleButton) {
          menuToggleButton.addEventListener('click', toggleTheme);
        }
      });
      
      // ã‚·ã‚¹ãƒ†ãƒ è¨­å®šã®å¤‰æ›´ã‚’ç›£è¦–
      if (window.matchMedia) {
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
          // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ‰‹å‹•ã§è¨­å®šã—ã¦ã„ãªã„å ´åˆã®ã¿ã€ã‚·ã‚¹ãƒ†ãƒ è¨­å®šã«å¾“ã†
          if (!localStorage.getItem(THEME_KEY)) {
            applyTheme(e.matches ? 'dark' : 'light');
          }
        });
      }
    })();
  </script>
  
  <!-- ãƒ¡ãƒ‹ãƒ¥ãƒ¼åˆ¶å¾¡ç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
  {% if user.is_authenticated %}
  <script>
      document.addEventListener('DOMContentLoaded', function() {
          const openMenuButton = document.getElementById('openMenuButton');
          const closeMenuButton = document.getElementById('closeMenuButton');
          const fullscreenMenu = document.getElementById('fullscreenMenu');
          
          // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‹ã
          openMenuButton.addEventListener('click', function() {
              fullscreenMenu.classList.add('active');
              document.body.style.overflow = 'hidden'; // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢
          });
          
          // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‰ã˜ã‚‹
          closeMenuButton.addEventListener('click', function() {
              fullscreenMenu.classList.remove('active');
              document.body.style.overflow = ''; // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¾©å¸°
          });
          
          // ãƒ¡ãƒ‹ãƒ¥ãƒ¼å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
          fullscreenMenu.addEventListener('click', function(e) {
              if (e.target === fullscreenMenu) {
                  fullscreenMenu.classList.remove('active');
                  document.body.style.overflow = '';
              }
          });
          
          // ESCã‚­ãƒ¼ã§é–‰ã˜ã‚‹
          document.addEventListener('keydown', function(e) {
              if (e.key === 'Escape' && fullscreenMenu.classList.contains('active')) {
                  fullscreenMenu.classList.remove('active');
                  document.body.style.overflow = '';
              }
          });
      });
  </script>
  <script src="{% static 'js/speed-dial.js' %}"></script>
  <script src="{% static 'js/image-compression.js' %}"></script>
<script>
// ç”»åƒãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºæ©Ÿèƒ½
function showImageModal(imageUrl, title) {
  const modal = new bootstrap.Modal(document.getElementById('imageModal'));
  const modalImage = document.getElementById('modalImage');
  const modalTitle = document.getElementById('imageModalLabel');
  const downloadBtn = document.getElementById('modalImageDownload');
  
  modalImage.src = imageUrl;
  modalTitle.textContent = title || 'ç”»åƒè¡¨ç¤º';
  downloadBtn.href = imageUrl;
  
  // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«åã‚’è¨­å®š
  const fileName = title ? `${title.replace(/[^a-zA-Z0-9\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]/g, '_')}.jpg` : 'image.jpg';
  downloadBtn.setAttribute('download', fileName);
  
  modal.show();
}

// ç”»åƒèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼æ™‚ã®å‡¦ç†
document.addEventListener('DOMContentLoaded', function() {
  // ã™ã¹ã¦ã®ç”»åƒã«å¯¾ã—ã¦ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’è¿½åŠ 
  document.querySelectorAll('img[onclick*="showImageModal"]').forEach(img => {
    img.addEventListener('error', function() {
      this.style.display = 'none';
      console.error('ç”»åƒã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ:', this.src);
    });
    
    img.addEventListener('load', function() {
      // èª­ã¿è¾¼ã¿æˆåŠŸæ™‚ã®å‡¦ç†ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
      this.style.opacity = '1';
    });
  });
});

// ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—æ©Ÿèƒ½ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
document.addEventListener('DOMContentLoaded', function() {
  const fileInputs = document.querySelectorAll('input[type="file"][accept*="image"]');
  
  fileInputs.forEach(input => {
    const parent = input.closest('.form-section, .mb-3');
    if (!parent) return;
    
    // ãƒ‰ãƒ©ãƒƒã‚°ã‚ªãƒ¼ãƒãƒ¼å‡¦ç†
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
      parent.addEventListener(eventName, preventDefaults, false);
    });
    
    ['dragenter', 'dragover'].forEach(eventName => {
      parent.addEventListener(eventName, highlight, false);
    });
    
    ['dragleave', 'drop'].forEach(eventName => {
      parent.addEventListener(eventName, unhighlight, false);
    });
    
    parent.addEventListener('drop', handleDrop, false);
    
    function preventDefaults(e) {
      e.preventDefault();
      e.stopPropagation();
    }
    
    function highlight(e) {
      parent.classList.add('dragover');
    }
    
    function unhighlight(e) {
      parent.classList.remove('dragover');
    }
    
    function handleDrop(e) {
      const dt = e.dataTransfer;
      const files = dt.files;
      
      if (files.length > 0) {
        input.files = files;
        // change ã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒˆãƒªã‚¬ãƒ¼
        const event = new Event('change', { bubbles: true });
        input.dispatchEvent(event);
      }
    }
  });
});
</script>
  {% endif %}
  
  {% block extra_js %}{% endblock %}

  {% block scripts %}

<script src="{% static 'js/common-utils.js' %}"></script>

{% if user.is_authenticated %}
<!-- é€šçŸ¥é–¢é€£JavaScript -->
<script src="{% static 'js/toast.js' %}"></script>
<script src="{% static 'js/push-notifications.js' %}"></script>
<script src="{% static 'js/notification-ui.js' %}"></script>

<!-- é€šçŸ¥ãƒ™ãƒ«ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼ã«çµ±åˆï¼‰ -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // ãƒ˜ãƒƒãƒ€ãƒ¼ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã®å‰ã«é€šçŸ¥ãƒ™ãƒ«ã‚’è¿½åŠ 
    const userDropdown = document.getElementById('userDropdown');
    if (userDropdown) {
        const bellContainer = document.createElement('div');
        bellContainer.className = 'notification-bell-container position-relative me-3';
        bellContainer.innerHTML = `
            <button class="btn btn-link text-dark position-relative" id="notification-bell" aria-label="é€šçŸ¥">
                <i class="bi bi-bell" style="font-size: 1.25rem;"></i>
                <span id="notification-badge" class="position-absolute top-0 start-100 badge rounded-pill bg-danger" style="display: none;">
                    0
                </span>
            </button>
            
            <!-- é€šçŸ¥ãƒ‘ãƒãƒ« -->
            <div class="dropdown-menu dropdown-menu-end shadow" id="notification-panel" style="display: none; width: 400px; max-height: 500px; overflow-y: auto;">
                <div class="d-flex justify-content-between align-items-center p-3 border-bottom">
                    <h6 class="mb-0">é€šçŸ¥</h6>
                    <button class="btn btn-sm btn-link" id="mark-all-read-btn">
                        <i class="bi bi-check-all"></i> ã™ã¹ã¦æ—¢èª­
                    </button>
                </div>
                <div id="notification-list" class="p-2">
                    <!-- é€šçŸ¥ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
                </div>
            </div>
        `;
        
        userDropdown.parentNode.parentNode.insertBefore(bellContainer, userDropdown.parentNode);
        
        // é€šçŸ¥ãƒ‘ãƒãƒ«ã®è¡¨ç¤º/éè¡¨ç¤º
        document.getElementById('notification-bell').addEventListener('click', function(e) {
            e.stopPropagation();
            const panel = document.getElementById('notification-panel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        });
        
        // ãƒ‘ãƒãƒ«å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
        document.addEventListener('click', function(e) {
            const panel = document.getElementById('notification-panel');
            const bell = document.getElementById('notification-bell');
            if (!panel.contains(e.target) && e.target !== bell && !bell.contains(e.target)) {
                panel.style.display = 'none';
            }
        });
    }
});
</script>
{% endif %}
  {% endblock %}
</body>
</html>